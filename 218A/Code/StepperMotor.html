<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="StepperMotor_files/filelist.xml">
<title>Download module</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>sabrina</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>sabrina</o:LastAuthor>
  <o:Revision>3</o:Revision>
  <o:TotalTime>3</o:TotalTime>
  <o:Created>2009-11-30T05:20:00Z</o:Created>
  <o:LastSaved>2009-12-04T21:56:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>610</o:Words>
  <o:Characters>3483</o:Characters>
  <o:Company>tam</o:Company>
  <o:Lines>29</o:Lines>
  <o:Paragraphs>8</o:Paragraphs>
  <o:CharactersWithSpaces>4085</o:CharactersWithSpaces>
  <o:Version>10.2625</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:\5B8B\4F53;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 2 3 0 0 0 0 0 0 0;
	mso-font-alt:\65B0\7D30\660E\9AD4;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:3 137232384 22 0 1048577 0;}
@font-face
	{font-family:"\@SimSun";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:"\@PMingLiU";
	panose-1:2 2 3 0 0 0 0 0 0 0;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:3 137232384 22 0 1048577 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-hyphenate:none;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;
	mso-font-kerning:1.0pt;
	mso-fareast-language:AR-SA;}
@page Section1
	{size:8.5in 11.0in;
	margin:.5in .5in .5in .5in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:89857020;
	mso-list-template-ids:67698719;
	mso-list-style-name:Recipe;}
@list l0:level1
	{mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;
	color:windowtext;}
@list l0:level2
	{mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:.55in;
	mso-level-number-position:left;
	margin-left:.55in;
	text-indent:-.3in;}
@list l0:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	margin-left:.85in;
	text-indent:-.35in;}
@list l0:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.2in;
	text-indent:-.45in;}
@list l0:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:1.75in;
	mso-level-number-position:left;
	margin-left:1.55in;
	text-indent:-.55in;}
@list l0:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	margin-left:1.9in;
	text-indent:-.65in;}
@list l0:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	margin-left:2.25in;
	text-indent:-.75in;}
@list l0:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:2.75in;
	mso-level-number-position:left;
	margin-left:2.6in;
	text-indent:-.85in;}
@list l0:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:3.25in;
	mso-level-number-position:left;
	margin-left:3.0in;
	text-indent:-1.0in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal style='page-break-before:always'><span style='font-size:
9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>StepperMotor
Module<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'>This software module <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><span style='mso-spacerun:yes'>  </span>1)
Reads input from grapple dial to control the stepper motor<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><span style='mso-spacerun:yes'>  </span>2)
Controls the stepper motor<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><span style='mso-spacerun:yes'>  </span>3)
Keeps track of the number of steps which determines Tom Cruise's position<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'>Public Functions:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>initStepMotor(howManySteps)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Update all timing variables to the current
time<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Set the motor direction to raise Tom Cruise<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Run the motor for a number of steps specified
by the input howManySteps<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Set the motor direction to lower Tom Cruise<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Run the motor to a calibrated start position<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Reset the internal count for motor position
to zero<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span><o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Read the grapple control dial position by
calling readDial() which returns a number the ranges<span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>from 0 to 1000<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If the dial position is in the neutral
position (about middle of the dial range)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set a flag that indicates that the dial is
in control of the motor<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set a flag that the dial must first be in
the neutral position before it is allowed to control <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:14.25pt 24.75pt 35.25pt 47.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>the motor<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>resetStepMotorStatus<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If motor position is zero<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Return<span style='mso-spacerun:yes'> 
</span>MOTOR_NOT_IN_RANGE_STATUS<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set the motor direction to raise Tom Cruise<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Run the motor at a calibrated reset speed<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Return MOTOR_RESETTING_STATUS<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>slowVictoryReset<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If motor position is zero<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Return<span style='mso-spacerun:yes'> 
</span>MOTOR_NOT_IN_RANGE_STATUS<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set the motor direction to raise Tom Cruise<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Run the motor at a calibrated victory speed<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Return MOTOR_RESETTING_STATUS<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>checkStepMotorStatus<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Read in grapple control dial by calling readDial()
which returns a value from 0 to 1000<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Based on grapple control dial position,
determine commanded grapple direction and speed<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If flag indicates grapple control dial
started not in the neutral position<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Ignore grapple control dial input and assume
it is reading neutral (not commanding a motor spd)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set a flag indicating that the grapple
control dial is now in control of the motor<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span><o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Calculate speed (which is actually commanded
by a wait time)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Linearize between calibrated min and max wait
times (corresponding to max and min speeds of the <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>motor) based off the relative position of the
control dial from the neutral position<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If motor is commanded to raise and motor
position is greater than zero OR<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span><span style='mso-spacerun:yes'>  
</span>motor is commanded to lower and motor position is less than the
calibrated floor position<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Run motor at commanded speed by calling
runMotor(cmdWaitTime) which runs the motor at the <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>specified speed = 1/cmdWaitTime<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If motor position is equal to calibrated
floor position<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Return MOTOR_HIT_FLOOR_STATUS<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>If motor position is in the calibrated
position window for the computer<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:3'>       </span>Return<span style='mso-spacerun:yes'> 
</span>MOTOR_IN_RANGE_STATUS<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:13.5pt 24.0pt 35.25pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:3'>       </span>Return<span style='mso-spacerun:yes'> 
</span>MOTOR_NOT_IN_RANGE_STATUS<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'>Module Functions:<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>runMotor(cmdWaitTime)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Filter input speed to prevent instantaneous
accelerations of the stepper motor<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If cmdWaitTime is greater than the current
motor speed (which is actually expressed as a wait <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>time because all motor speeds are actually
1/motor wait times)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set cmdWaitTime to be one step faster than
the current motor speed<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If cmdWaitTime is less than the current motor
speed<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set cmdWaitTime to be one step slower than
the current motor speed<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Read the current time<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If the current time minus the time when the
last motor step was commanded<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Command a step by calling pulseClock()<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Save the current speed for future filtering<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Update the timing variable with the current
time<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Update the motor position<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>readDial<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Read in analog dial as number between 0 and
1023, store as myPos<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If myPos is less than calibrated zero
position on dial<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Return 0<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>If myPos is greater than the calibrated
fully on position<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:3'>       </span>Return 1000<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:3'>       </span>Linearize between two extreme
calibrations in the following manner (to avoid floating point <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:3'>       </span>math):<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><span style='mso-spacerun:yes'>     
</span>myTemp = (1000*((long)myPos-dialLO));<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU'><span style='mso-spacerun:yes'>     
</span>myCalc = (int)((myTemp)/((dialHI-dialLO)));<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-spacerun:yes'>      </span>return myCalc;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>setDir(dir)<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>If dir<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set stepper motor driver direction line to
HI<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Else<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:2'>     </span>Set stepper motor driver direction line to
LO<span style='mso-tab-count:3'>                   </span><o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'>pulseClock<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Set step command line to HI<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Delay slightly to ensure CLOCK outp</span><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'>u</span><span style='font-size:9.0pt;font-family:
"Courier New";mso-fareast-font-family:PMingLiU'>t stays HI for at least 10[us]<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:15.0pt 26.25pt 35.25pt 46.5pt'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU'><span
style='mso-tab-count:1'>   </span>Set step command line to LO<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
