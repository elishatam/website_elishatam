<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="MainC_files/filelist.xml">
<title>/***************************************************************************</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="date"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>sabrina</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>sabrina</o:LastAuthor>
  <o:Revision>4</o:Revision>
  <o:TotalTime>5</o:TotalTime>
  <o:Created>2009-12-03T03:25:00Z</o:Created>
  <o:LastSaved>2009-12-03T03:31:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1641</o:Words>
  <o:Characters>9359</o:Characters>
  <o:Company>tam</o:Company>
  <o:Lines>77</o:Lines>
  <o:Paragraphs>21</o:Paragraphs>
  <o:CharactersWithSpaces>10979</o:CharactersWithSpaces>
  <o:Version>10.2625</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DontDisplayPageBoundaries/>
  <w:GrammarState>Clean</w:GrammarState>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:\5B8B\4F53;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 2 3 0 0 0 0 0 0 0;
	mso-font-alt:\65B0\7D30\660E\9AD4;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:3 137232384 22 0 1048577 0;}
@font-face
	{font-family:"\@SimSun";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:"\@PMingLiU";
	panose-1:2 2 3 0 0 0 0 0 0 0;
	mso-font-charset:136;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:3 137232384 22 0 1048577 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:.5in .5in 1.0in .5in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:89857020;
	mso-list-template-ids:67698719;
	mso-list-style-name:Recipe;}
@list l0:level1
	{mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;
	color:windowtext;}
@list l0:level2
	{mso-level-text:"%1\.%2\.";
	mso-level-tab-stop:.55in;
	mso-level-number-position:left;
	margin-left:.55in;
	text-indent:-.3in;}
@list l0:level3
	{mso-level-text:"%1\.%2\.%3\.";
	mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	margin-left:.85in;
	text-indent:-.35in;}
@list l0:level4
	{mso-level-text:"%1\.%2\.%3\.%4\.";
	mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.2in;
	text-indent:-.45in;}
@list l0:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.";
	mso-level-tab-stop:1.75in;
	mso-level-number-position:left;
	margin-left:1.55in;
	text-indent:-.55in;}
@list l0:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.";
	mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	margin-left:1.9in;
	text-indent:-.65in;}
@list l0:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.";
	mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	margin-left:2.25in;
	text-indent:-.75in;}
@list l0:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.";
	mso-level-tab-stop:2.75in;
	mso-level-number-position:left;
	margin-left:2.6in;
	text-indent:-.85in;}
@list l0:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9\.";
	mso-level-tab-stop:3.25in;
	mso-level-number-position:left;
	margin-left:3.0in;
	text-indent:-1.0in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>/***************************************************************************<o:p></o:p></span></p>

<p class=MsoNormal><st1:place><span style='font-size:9.0pt;font-family:"Courier New";
 mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>Main</span></st1:place><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> for FLICKER (aaaProjectMain.c)<o:p></o:p></span></p>

<p class=MsoNormal><st1:place><span style='font-size:9.0pt;font-family:"Courier New";
 mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>Mission</span></st1:place><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> Impossible Flicker<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>Team Firefox<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>ME 218A </span><st1:date
Month="11" Day="20" Year="2009"><span style='font-size:9.0pt;font-family:"Courier New";
 mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>11/20/09</span></st1:date><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>This software
module runs the flicker at a high level<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>****************************************************************************/<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&lt;timers12.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&lt;stdio.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&lt;ME218_C32.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&quot;StepperMotor.h&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&quot;Download.h&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&quot;LEDMap.h&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&quot;IR.h&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&quot;Flicker.h&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&quot;Stage_LEDs.h&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>#include
&quot;Music.h&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>//Flicker is run
as a state machine with the following states:<o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:9.0pt;font-family:
"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>typedef</span></span><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> enum {<span style='mso-spacerun:yes'> 
</span>IDLE,<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>IR,<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>GRAPPLE,<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>DOWNLOAD,<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>FAIL,<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>SUCCESS,<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>RESET_SHOW<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>  </span>} STATE_t;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>//This function is
used to coordinate timing between FLICKER and MP3 player at power up<o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:9.0pt;font-family:
"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>void</span></span><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> wait(unsigned int);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>//Calibrations<o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:9.0pt;font-family:
"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>static</span></span><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> unsigned int SuccessTime = 8000;<span
style='mso-tab-count:2'>         </span>//Time to show success display in ms<o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:9.0pt;font-family:
"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>static</span></span><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> unsigned int FailTime = 3000;<span
style='mso-tab-count:2'>            </span>//Time to show fail display in ms<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:9.0pt;font-family:
"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>void</span></span><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> main() {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>STATE_t myState;<span style='mso-tab-count:
1'>     </span>//Current state<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>STATE_t dummyState; <span
style='mso-tab-count:1'> </span>//Used to prevent switching states within one
while loop iteration<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>static</span> char
isAlerted;<span style='mso-tab-count:2'>             </span>//Indicates weather
user made Tom hit the floor<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>static</span> unsigned
int finaleTime;<span style='mso-tab-count:1'>    </span>//Timing variables for
the fail and success displays<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>static</span> unsigned
int myTime;<span style='mso-tab-count:2'>        </span>//Timing variable<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>FLICKER_EVENT_t myFlickerEvent;<span
style='mso-tab-count:1'>    </span>//Event variables for each event driven
module<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>MOTOR_STATUS_t myMotorStatus;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>DOWNLOAD_EVENT_t myDLEvent;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>LEDMap_Status_t myLEDMapStatus;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>IR_STATUS_t myIRStatus;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.0in;text-indent:-3.0in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span style='mso-spacerun:yes'>      </span><span
class=GramE>static</span> char waitingOnIRActive;<span style='mso-tab-count:
1'>     </span>//Used in case IR beam misreads on new game; forces user <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.0in;text-indent:-3.0in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                                        
</span>//break the IR beam a few times before continuing onto next <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.0in;text-indent:-3.0in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                                        
</span>//stage<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>       </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>//set 1 [ms] clock for use by all modules<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>TMRS12_<span class=GramE>Init(</span>TMRS12_RATE_1MS);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>//set I/O pins<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>DDRM = 0x3C;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>DDRT = 0xFE;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>ADS12_<span class=GramE>Init(</span>&quot;OOOOOOOA&quot;);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>//MP3 player takes a few seconds to boot
up on power up; delay FLICKER by 2 sec to ensure MP3<span
style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>//player is ready to accept button push
commands<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>wait(</span>2000);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>//Intialize modules (can be blocking)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>initStepMotor(</span>100);<span
style='mso-tab-count:1'>  </span>//Ram Tom Cruise into stop for 100 steps to
ensure correct zero position <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'>//on stepper motor<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>initDownload(</span>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>initLEDMap(</span>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>initFlicker(</span>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>     </span><span style='mso-spacerun:yes'> </span><span
class=GramE>initMusic(</span>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>myState</span> = IDLE;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span class=GramE>while(</span>1) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>        </span>//run state specific code<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>        </span><span class=GramE>dummyState</span> =
myState;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>        </span><span class=GramE>switch</span>
(dummyState) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span class=GramE>case</span> IDLE:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>//Set indicator LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>turnOnActive(</span>0);<span
style='mso-tab-count:3'>                  </span>//Turn off ultra-bright white
LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>turnOnFail(</span>0);<span
style='mso-tab-count:3'>                    </span>//Turn off red LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>activateStage(</span>STAGE_IDLE);<span
style='mso-tab-count:1'> </span><span style='mso-spacerun:yes'>      
</span>//Turn off all stage indicator LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>//Check for active signal from
forced start button or opto-iso<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myFlickerEvent</span>
= checkFlickerEvents();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(myFlickerEvent == FLICKER_START) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>startLEDMap(</span>);<span
style='mso-spacerun:yes'>                                </span>//Start LED
Guard map<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:4.5in;text-indent:-4.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span style='mso-spacerun:yes'>               
</span><span class=GramE>myIRStatus</span> = checkIRStatus();<span
style='mso-spacerun:yes'>                 </span>//Check if IR beam is already
broken <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:4.5in;text-indent:-4.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                                                            
</span><span style='mso-spacerun:yes'> </span>/<span class=GramE>/(</span>which
shouldn’t happen)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>if</span>
(myIRStatus == IR_BROKEN_STATUS) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                  </span><span class=GramE>waitingOnIRActive</span>
= 1; <span style='mso-tab-count:3'>                     </span>//Make note that
IR beam already broken<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>else</span> {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>            </span><span
style='mso-spacerun:yes'>      </span><span class=GramE>waitingOnIRActive</span>
= 0; <span style='mso-tab-count:3'>                     </span>//IR beam is
reading fine<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myState</span>
= IR;<span style='mso-tab-count:5'>                                 </span>//Move
on to next state<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>} <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span class=GramE>case</span> IR:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>//Play Mission Impossible music<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>playMusic(</span>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>//Set indicator LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>turnOnActive(</span>0);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>turnOnFail(</span>1);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>activateStage(</span>STAGE_IR);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-tab-count:2'>              </span>//Check if guard has arrived
(meaning user failed)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myLEDMapStatus</span>
= checkLEDMapEvents();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(myLEDMapStatus == LEDMap_GUARD_ARRIVED) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myState</span>
= FAIL; <span style='mso-tab-count:3'>                </span><span
style='mso-spacerun:yes'>        </span>//Move on to fail state<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>finaleTime</span>
= TMRS12_GetTime();<span style='mso-tab-count:1'>  </span><span
style='mso-spacerun:yes'>        </span>//Record the start time of the fail
display<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:9.0pt;
font-family:"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:
ZH-TW'>//Check if IR beam is broken (if so, move on to next stage as long as IR
beam is <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:9.0pt;
font-family:"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:
ZH-TW'>//reading correctly)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myIRStatus</span>
= checkIRStatus();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>           </span><span
style='mso-spacerun:yes'>   </span><span class=GramE>if</span> (myIRStatus ==
IR_BROKEN_STATUS) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>if</span>
(!waitingOnIRActive) { <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                  </span><span class=GramE>myState</span>
= GRAPPLE;<span style='mso-tab-count:1'>     </span><span
style='mso-spacerun:yes'>       </span>//Move on to next stage<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-tab-count:2'>              </span><span
style='mso-spacerun:yes'>     </span><span class=GramE>isAlerted</span> = 0;<span
style='mso-tab-count:2'>        </span><span style='mso-spacerun:yes'>      
</span>//Indicates that the alarm hasn’t been tripped<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                  </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>else</span> {<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.0in;text-indent:-3.0in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span style='mso-spacerun:yes'>               
</span><span class=GramE>waitingOnIRActive</span> = 0;<span style='mso-tab-count:
1'>   </span>//IR beam is reading fine, no need to wait for a change in <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.0in;text-indent:-3.0in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                                         </span>//the
signal<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span class=GramE>case</span> GRAPPLE:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>//Set indicator LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(isAlerted) {<span style='mso-tab-count:2'>           </span>//If the alarm is
tripped, blink lights<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>blinkFail(</span>150);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>blinkActive(</span>250);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>else</span>
{<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>turnOnActive(</span>1);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'>             </span><span class=GramE>turnOnFail(</span>0);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>activateStage(</span>STAGE_GRAPPLE);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'>//Check if guard has arrived (meaning user failed)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myLEDMapStatus</span>
= checkLEDMapEvents();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(myLEDMapStatus == LEDMap_GUARD_ARRIVED) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myState</span>
= FAIL; <span style='mso-tab-count:3'>                </span>//Move on to fail
state<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>finaleTime</span>
= TMRS12_GetTime();<span style='mso-tab-count:1'>  </span>//Record the start
time of the fail display<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-tab-count:2'>              </span>//Allow user to run the motor
using the grapple control dial<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myMotorStatus</span>
= checkStepMotorStatus();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(myMotorStatus == MOTOR_NOT_IN_RANGE_STATUS) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                   </span><span class=GramE>resetDownload(</span>);<span
style='mso-tab-count:1'>      </span>//If Tom is not in range of the computer
reset the download <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.0in'><span style='font-size:9.0pt;
font-family:"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:
ZH-TW'>/<span class=GramE>/(</span>this also causes the download progress LEDs
to turn off)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(myMotorStatus == MOTOR_IN_RANGE_STATUS) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-tab-count:2'>              </span><span
style='mso-spacerun:yes'>      </span>//Check if the download has been started
as a result of the user inserting the <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:9.0pt;
font-family:"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:
ZH-TW'><span style='mso-spacerun:yes'>      </span>//disk<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                   </span><span class=GramE>myDLEvent</span>
= checkDownloadEvents(); <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                   </span><span class=GramE>if</span>
(myDLEvent == DOWNLOAD_STARTED_EVENT){<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                      </span><span class=GramE>myState</span>
= DOWNLOAD;<span style='mso-tab-count:1'>       </span>//Move on to next state<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.5in;text-indent:-3.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                      </span><span class=GramE>clearDownloadDisplay(</span>);<span
style='mso-tab-count:1'>   </span>//Make sure all progress LEDs turn off (could
still <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:3.5in;text-indent:-3.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span style='mso-spacerun:yes'>             
</span><span
style='mso-spacerun:yes'>                                  </span>//be on from
blinking)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                      </span><span class=GramE>break</span>;
<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                   </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(myMotorStatus == MOTOR_HIT_FLOOR_STATUS) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>       </span><span style='mso-tab-count:1'>       </span><span
style='mso-spacerun:yes'>      </span>//If user hits the floor, not an
automatic fail, just speed up guard map and<span style='mso-spacerun:yes'> 
</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'><span style='mso-spacerun:yes'>      </span>//flash
floor and ceiling lights<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:9.0pt;
font-family:"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:
ZH-TW'><span style='mso-spacerun:yes'>      </span><span class=GramE>LEDMapGuardAlerted(</span>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                   </span><span class=GramE>isAlerted</span>
= 1;<span style='mso-tab-count:2'>        </span>//Indicates that the floor and
ceiling lights should be <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:2.5in;text-indent:.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'>//blinked<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span class=GramE>case</span>
DOWNLOAD:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>//Set indicator LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
(isAlerted) {<span style='mso-tab-count:2'>           </span>//If the alarm is
tripped, flash lights<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>blinkFail(</span>150);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>blinkActive(</span>250);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>else</span>
{<span style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>turnOnActive(</span>1);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>turnOnFail(</span>0);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>activateStage(</span>STAGE_DOWNLOAD);<span
style='mso-tab-count:1'>    </span>//Turn on the correct stage indicator LED<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'>//Check if guard has arrived (meaning user failed)<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myLEDMapStatus</span>
= checkLEDMapEvents();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'>           </span><span class=GramE>if</span>
(myLEDMapStatus == LEDMap_GUARD_ARRIVED) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myState</span>
= FAIL; <span style='mso-tab-count:3'>                </span>//Move on to fail
state<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>finaleTime</span>
= TMRS12_GetTime();<span style='mso-tab-count:1'>  </span>//Record the start
time of the fail display<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span
style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-tab-count:2'>              </span>//Check if download has completed<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myDLEvent</span>
= checkDownloadEvents();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
((myDLEvent == DOWNLOAD_COMPLETE_EVENT) &amp;&amp; (!isDiskIn())){ //User must
eject disk <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                                                                           
</span>//after download has <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                                                                           
</span>//completed<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>restartMusic(</span>);<span
style='mso-tab-count:1'>   </span><span style='mso-tab-count:2'>              </span>//Start
MI theme over again<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myState</span>
= SUCCESS;<span style='mso-tab-count:2'>       </span><span
style='mso-spacerun:yes'>       </span>//Move on to success state<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>resetDownload(</span>);<span
style='mso-tab-count:3'>                </span>//Clear the download progress
LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>finaleTime</span>
= TMRS12_GetTime();<span style='mso-tab-count:1'>  </span>//Record the start
time of the success display<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span class=GramE>case</span> FAIL:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>stopMusic(</span>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myTime</span> =
TMRS12_GetTime();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>blinkFail(</span>150);<span
style='mso-tab-count:3'>                   </span>//Blink the red LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>turnOnActive(</span>0);<span
style='mso-tab-count:3'>                  </span>//Turn off the ultra-bright
white LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-tab-count:2'>              </span>//Check if enough time has passed
for the fail display to be over<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span>
((myTime - finaleTime) &gt; FailTime) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>startNextFlicker(</span>);<span
style='mso-tab-count:1'>      </span><span style='mso-spacerun:yes'>     
</span>//Signal next flicker to start<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myState</span>
= RESET_SHOW;<span style='mso-spacerun:yes'>  </span><span style='mso-tab-count:
1'>  </span><span style='mso-spacerun:yes'>      </span>//Move on to state that
resets the FLICKER<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span class=GramE>case</span>
SUCCESS:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>slowVictoryReset(</span>);<span
style='mso-tab-count:3'>               </span>//Slowly raise Tom Cruise back to
start position<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span
style='mso-spacerun:yes'>    </span><span class=GramE>myTime</span> =
TMRS12_GetTime();<span style='mso-tab-count:1'> </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>blinkActive(</span>150);
<span style='mso-tab-count:3'>                </span>//Blink ultra-bright white
LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>turnOnFail(</span>0);<span
style='mso-tab-count:3'>                    </span>//Turn off Red LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-tab-count:2'>              </span>//Check if enough time has passed
for the success display to be over<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>if</span> ((myTime
- finaleTime) &gt; SuccessTime) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>stopMusic(</span>);<span
style='mso-tab-count:2'>             </span>//Stop the music<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>startNextFlicker(</span>);
<span style='mso-tab-count:1'>     </span>//Signal next flicker to start<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myState</span>
= RESET_SHOW;<span style='mso-tab-count:1'>    </span>// Move on to state that
resets the FLICKER<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span><span
style='mso-spacerun:yes'>        </span><span class=GramE>break</span>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>          </span><span class=GramE>case</span>
RESET_SHOW:<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>initLEDMap();<span
style='mso-spacerun:yes'>        </span>//Reset guard map<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'>           </span><span class=GramE>resetStage(</span>);<span
style='mso-tab-count:1'> </span><span style='mso-spacerun:yes'>       </span>//Turn
off all stage indicator LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>resetDownload(</span>);<span
style='mso-spacerun:yes'>    </span>//Turn off all the download progress LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>        </span><span
style='mso-spacerun:yes'>      </span><span class=GramE>turnOnActive(</span>0);<span
style='mso-spacerun:yes'>    </span>//Turn off the ultra-bright white LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>turnOnFail(</span>0);<span
style='mso-spacerun:yes'>      </span>//Turn off the red LEDs<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span>//Make sure the motor is back in
the start position <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:9.0pt;
font-family:"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:
ZH-TW'><span style='mso-spacerun:yes'> </span><span class=GramE>do</span> {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>                </span><span class=GramE>myMotorStatus</span>
= resetStepMotorStatus();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>            </span><span
style='mso-spacerun:yes'>  </span>} while (myMotorStatus ==
MOTOR_RESETTING_STATUS);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>initStepMotor(</span>50);<span
style='mso-tab-count:1'>  </span>//Ram Tom Cruise into the stop for 50 steps to
reset the stepper <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:2.0in;text-indent:.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'>//motor position<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>myState</span>
= IDLE;<span style='mso-tab-count:1'>     </span>//Move to the idle state where
the flicker will wait to be <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:2.0in;text-indent:.5in'><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'>//restarted<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>              </span><span class=GramE>break</span>; <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>        </span>}<span style='mso-spacerun:yes'>     
</span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>      </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>}<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>//delay for a
specified number of ms<o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:9.0pt;font-family:
"Courier New";mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>static</span></span><span
style='font-size:9.0pt;font-family:"Courier New";mso-fareast-font-family:PMingLiU;
mso-fareast-language:ZH-TW'> void wait(unsigned int ms) {<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>  </span><span class=GramE>unsigned</span> int myTime
= 0;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>  </span><span class=GramE>myTime</span> =
TMRS12_GetTime();<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>  </span>//wait until the current time minus the start
time is greater than the wait time<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'><span
style='mso-spacerun:yes'>  </span><span class=GramE>while</span>
((TMRS12_GetTime() - myTime) &lt; ms) {};<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
mso-fareast-font-family:PMingLiU;mso-fareast-language:ZH-TW'>}<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
