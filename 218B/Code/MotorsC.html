<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="MotorsC_files/filelist.xml">
<title>#define TEST</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="State"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="City"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>6 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>3</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:DoNotShadeFormData/>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:AdjustLineHeightInTable/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
   <w:SelectEntireFieldWithStartOrEnd/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
  <w:LsdException Locked="true" Name="Normal"/>
  <w:LsdException Locked="true" Name="heading 1"/>
  <w:LsdException Locked="true" Name="heading 2"/>
  <w:LsdException Locked="true" Name="heading 3"/>
  <w:LsdException Locked="true" Name="heading 4"/>
  <w:LsdException Locked="true" Name="heading 5"/>
  <w:LsdException Locked="true" Name="heading 6"/>
  <w:LsdException Locked="true" Name="heading 7"/>
  <w:LsdException Locked="true" Name="heading 8"/>
  <w:LsdException Locked="true" Name="heading 9"/>
  <w:LsdException Locked="true" Name="toc 1"/>
  <w:LsdException Locked="true" Name="toc 2"/>
  <w:LsdException Locked="true" Name="toc 3"/>
  <w:LsdException Locked="true" Name="toc 4"/>
  <w:LsdException Locked="true" Name="toc 5"/>
  <w:LsdException Locked="true" Name="toc 6"/>
  <w:LsdException Locked="true" Name="toc 7"/>
  <w:LsdException Locked="true" Name="toc 8"/>
  <w:LsdException Locked="true" Name="toc 9"/>
  <w:LsdException Locked="true" Name="caption"/>
  <w:LsdException Locked="true" Name="Title"/>
  <w:LsdException Locked="true" Name="Subtitle"/>
  <w:LsdException Locked="true" Name="Strong"/>
  <w:LsdException Locked="true" Name="Emphasis"/>
  <w:LsdException Locked="true" Name="Table Grid"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Calibri;
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:Calibri;
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:841.85pt 1190.55pt;
	margin:56.7pt 56.7pt 56.7pt 56.7pt;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:Calibri;
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in;text-justify-trim:punctuation'>

<div class=Section1>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define TEST</span><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/**************************************************************************</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=SpellE><i><span style='font-size:10.0pt;
font-family:"Courier New";color:#666666'>Motors.c</span></i></span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>ME 218B Project Hats Off</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>Team Firefox</span></i><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>March 7, 2010</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>The robot uses 2 DC motors. Implements PWM</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>Versions:</span></i><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>2.1<span style='mso-spacerun:yes'>   </span>02-24-10<span
style='mso-spacerun:yes'>    </span>Lock wheel speeds, smarter duty cycle
limitation (pos and <span class=SpellE>neg</span>)</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>2.0<span style='mso-spacerun:yes'>   </span>02-21-10<span
style='mso-tab-count:1'>    </span>Acceleration limits, position control, min
controllable speed</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>1.1<span style='mso-tab-count:1'>   </span>02-19-10<span
style='mso-tab-count:1'>    </span>Motors stop at same time when one reaches
desired number of encoder counts.</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>1.0<span style='mso-spacerun:yes'>   </span>02-17-10<span
style='mso-spacerun:yes'>  </span><span style='mso-spacerun:yes'> </span><span
style='mso-spacerun:yes'> </span>PID control works but commanding zero speed as
each motor</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'><span style='mso-spacerun:yes'>                </span><span
style='mso-spacerun:yes'> </span><span class=GramE>reaches</span> target
position doesn't work (robot spins wildly</span></i><span style='font-size:
10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'><span style='mso-spacerun:yes'>                </span><span
style='mso-spacerun:yes'> </span><span class=GramE>near</span> end of maneuver)</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>***************************************************************************/</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Include Files
-------------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#include</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:red'>&quot;<span class=SpellE>Motors.h</span>&quot;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=SpellE><span class=GramE><span
style='font-size:10.0pt;font-family:"Courier New";color:#EC7F15'>typedef</span></span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><span
style='color:blue'>enum</span></span> <span style='mso-tab-count:1'>     </span><span
style='color:red'>{</span><span style='mso-spacerun:yes'>    </span><span
style='mso-tab-count:1'> </span><span style='color:black'>FORWARD</span><span
style='color:red'>,</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:4'>                        </span>BACKWARD</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><span style='mso-tab-count:2'>        </span><span
style='color:red'>}</span> <span class=SpellE><span style='color:black'>DIR_t</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=SpellE><span class=GramE><span
style='font-size:10.0pt;font-family:"Courier New";color:#EC7F15'>typedef</span></span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><span
style='color:blue'>enum</span></span> <span style='mso-tab-count:1'>     </span><span
style='color:red'>{</span> <span style='mso-tab-count:1'>    </span><span
style='color:black'>LOCKED</span><span style='color:red'>,</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span><span
style='mso-spacerun:yes'>        </span><span style='mso-tab-count:1'>    </span>OPPOSITE</span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>,</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:4'>                        </span>UNLOCKED</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><span style='mso-tab-count:2'>        </span><span
style='color:red'>}</span> <span class=SpellE><span style='color:black'>LOCKMODE_t</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Module Definitions
-----------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//#defines pins for portability</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define DCMOTOR0 BIT1HI</span><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//PP1</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define DCMOTOR1 BIT3HI</span><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//PP3</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define POTPIN 7</span><span style='font-size:10.0pt;font-family:
"Courier New"'><span style='mso-spacerun:yes'>          </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//PTAD07</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define _MS_ *3000</span><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>         </span><i><span
style='color:#666666'>//=3MHz = (24MHz / 8) from Timer <span class=SpellE>prescale</span></span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                          </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//Takes ~21[ms]
before overflow</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define TIME (20 _MS_)</span><span style='font-size:10.0pt;
font-family:"Courier New"'><span style='mso-spacerun:yes'>    </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//Number of
seconds I want to wait during OC</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define <span class=SpellE>printf</span> (void<span class=GramE>)<span
class=SpellE>printf</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Module Functions
-----------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> void</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <b><span style='color:black'>Motor0</span></b><span
style='color:red'>(</span><span class=SpellE><span style='color:blue'>int</span></span>
<span style='color:black'>DC</span><span style='color:red'>);</span> <span
style='mso-spacerun:yes'>     </span><i><span style='color:#666666'>//command
duty cycle [-100, 100]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> void</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <b><span style='color:black'>Motor1</span></b><span
style='color:red'>(</span><span class=SpellE><span style='color:blue'>int</span></span>
<span style='color:black'>DC</span><span style='color:red'>);</span> <span
style='mso-spacerun:yes'>     </span><i><span style='color:#666666'>//command
duty cycle [-100, 100]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> void</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Timers_Init</span></b></span><span style='color:red'>(</span><span
style='color:blue'>void</span><span style='color:red'>);</span> <span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//initializes
input capture for encoder readings</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:5'>                              </span><span
style='mso-spacerun:yes'>   </span><i><span style='color:#666666'>//and output
compare for PID control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Module Variables
-----------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> unsigned <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>uPeriod0</span><span style='color:red'>,</span> <span
style='color:black'>uPeriod1</span><span style='color:red'>;</span> <span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//period of
last encoder tick for each motor 1.34 [us]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><span
style='color:black'>DIR_t</span></span><span style='color:black'> dir0</span><span
style='color:red'>,</span> <span style='color:black'>dir1</span><span
style='color:red'>;</span> <span
style='mso-spacerun:yes'>               </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//encoder
direction</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> char</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:black'>newEdge0</span><span
style='color:red'>,</span> <span style='color:black'>newEdge1</span><span
style='color:red'>;</span> <span style='mso-spacerun:yes'>         </span><i><span
style='color:#666666'>//indicates if an encoder pulse has <span class=SpellE>occured</span>
in last 87 [ms]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>desSpd0</span><span style='color:red'>,</span> <span
style='color:black'>desSpd1</span><span style='color:red'>;</span><span
style='mso-tab-count:1'>  </span><span style='mso-spacerun:yes'>          
</span><i><span style='color:#666666'>//desired speeds of motors 0 and 1</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>curSpd0</span><span style='color:red'>,</span> <span
style='color:black'>curSpd1</span><span style='color:red'>;</span><span
style='mso-tab-count:1'>  </span><span style='mso-spacerun:yes'>          
</span><i><span style='color:#666666'>//current speeds of motors 0 and 1
(calculated every 20 [ms]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>duty0</span><span style='color:red'>,</span> <span
style='color:black'>duty1</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>     </span><span
style='mso-spacerun:yes'>            </span><i><span style='color:#666666'>//current
duty cycles of motors</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><span
style='color:black'>LOCKMODE_t</span></span><span style='color:black'> <span
class=SpellE>curLockMode</span></span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> long</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:black'>EncoderCount0</span><span
style='color:red'>,</span> <span style='color:black'>EncoderCount1</span><span
style='color:red'>;</span> <span style='mso-spacerun:yes'>              </span><i><span
style='color:#666666'>//encoder tick count</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> char</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:black'>EncoderTimeout0</span><span
style='color:red'>,</span> <span style='color:black'>EncoderTimeout1</span><span
style='color:red'>;</span> <span style='mso-spacerun:yes'>          </span><i><span
style='color:#666666'>//used to time out encoder pulses when motor is stopped</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> long</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:black'>desEncoderCount0</span>
<span style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>,</span> <span style='color:black'>desEncoderCount1</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//desired number of
encoder steps</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> char</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:black'>desEncoderFlag0</span>
<span style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>,</span> <span style='color:black'>desEncoderFlag1</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>//indicates that motors should stop after reaching</span></i>
<span class=SpellE><i><span style='color:#666666'>desEncoderCount</span></i></span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> unsigned <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>disablePID</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//disables speed
control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- <st1:place w:st="on"><st1:City
 w:st="on">Module</st1:City> <st1:State w:st="on">Cal</st1:State></st1:place>
Variables -------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>minControlRPM</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>40</span><span
style='color:red'>;</span> <span style='mso-tab-count:1'>     </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//Minimum speed
at which PID can control (actual value based on PID loop time</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:7'>                                          </span><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//is 27.4 RPM</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static float</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><span
style='color:black'>Kp</span></span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0.024</span><span style='color:red'>,</span> <span
class=SpellE><span style='color:black'>Ki</span></span> <span style='color:
red'>=</span> <span style='color:#A900A9'>0.006</span><span style='color:red'>;</span>
<i><span style='color:#666666'>//speed control<span style='mso-spacerun:yes'> 
</span><span class=SpellE>Kp</span> = 0.012, <span class=SpellE>Ki</span> =
0.004</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static float</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><span
style='color:black'>Kp_Pos</span></span> <span style='color:red'>=</span> <span
style='color:#A900A9'>2</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//1.6//0.6; //position control: <span class=SpellE>CmdVelocity</span>
= <span class=SpellE>Kp_pos</span>*<span class=SpellE>ErrorPosition</span>
[Encoder Counts]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>maxPosAccel</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>250</span><span
style='color:red'>,</span> <span class=SpellE><span style='color:black'>maxNegAccel</span></span>
<span style='color:red'>=</span> <span style='color:#A900A9'>1000</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//70;//max <span
class=SpellE>accel</span> rate in [RPM/Control <st1:place w:st="on">Loop</st1:place>
Time] = [RPM/20ms]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>DutyOffset</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>8</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//add 2 extra duty
points to motor 1 <span class=SpellE>cuz</span> he's slow</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//const static</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>// linear distance <span class=SpellE>cals</span></span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>EncoderTicksPerInch</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>288</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//assumes GR = 1.33
and wheel diameter = 110 [mm]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>EncoderTicksPerRev</span></span><span
style='mso-spacerun:yes'>  </span><span style='color:red'>=</span> <span
style='color:#A900A9'>7329</span><span style='color:red'>;</span><i><span
style='color:#666666'>// //7420 //7343; //assumes distance between wheels = 8
[in] and all the</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'><span
style='mso-spacerun:yes'>                                       </span><span
class=GramE>above</span></span></i><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>const</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> static <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>maxMotorSpeed</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>4500</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//calc: 5830 // [rpm]
of motor = 53*output shaft speed @14V</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//debug variables</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> unsigned <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>lastPrint</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> unsigned <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>minUPeriod</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>130</span><span
style='color:red'>;</span> <o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> unsigned <span
class=SpellE>int</span></span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span class=SpellE><span style='color:black'>maxUPeriod</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>21000</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_Init</span></b></span><span style='color:red'>(</span><span
style='color:blue'>void</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=SpellE><b><span
style='color:black'>Timers_<span class=GramE>Init</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span style='color:red'>);</span><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//setup IC for
encoder and OC for PID control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=SpellE><b><span
style='color:black'>MyTimer_<span class=GramE>Init</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span style='color:red'>);</span>
<i><span style='color:#666666'>//Make sure 1 ms timer is running</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>lastPrint</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
class=SpellE><b><span style='color:black'>MyTimer_GetTime</span></b></span><span
style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//setup PWM
using PWM modules</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><b><span style='color:black'>PWM0_<span
class=GramE>Init<span style='color:red;font-weight:normal'>(</span></span></span></b><span
style='color:#A900A9'>1</span><span style='color:red'>,</span><span
style='color:#A900A9'>1</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PWMPRCLK</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
style='color:black'>PWMPRCLK</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_PCKA2</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_PCKA0</span><span style='color:red'>) |</span> <span
style='color:black'>_S12_PCKA1</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//set <span class=SpellE>prescale</span> to 24MHz/4 =6MHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PWMSCLA</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>2</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>                    </span><i><span style='color:#666666'>//set
<span class=SpellE>postscale</span> to --&gt; 6MHz<span class=GramE>/(</span>4*2)=7.5kHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM0Period</span></b><span style='color:red'>(</span></span><span
style='color:#A900A9'>200</span><span style='color:red'>);</span><span
style='mso-spacerun:yes'>       </span><span
style='mso-spacerun:yes'>      </span><i><span style='color:#666666'>//period
contains 100 ticks --&gt;PWM frequency = 15kHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><b><span style='color:black'>PWM1_<span
class=GramE>Init<span style='color:red;font-weight:normal'>(</span></span></span></b><span
style='color:#A900A9'>1</span><span style='color:red'>,</span><span
style='color:#A900A9'>1</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PWMPRCLK</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
style='color:black'>PWMPRCLK</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_PCKA2</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_PCKA0</span><span style='color:red'>) |</span> <span
style='color:black'>_S12_PCKA1</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//set <span class=SpellE>prescale</span> to 24MHz/4 =6MHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PWMSCLA</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>2</span><span style='color:red'>;</span> <i><span
style='color:#666666'><span style='mso-tab-count:1'> </span><span
style='mso-spacerun:yes'>                   </span>//set <span class=SpellE>postscale</span>
to --&gt; 6MHz<span class=GramE>/(</span>4*2)=7.5kHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM1Period</span></b><span style='color:red'>(</span></span><span
style='color:#A900A9'>200</span><span style='color:red'>);</span><span
style='mso-spacerun:yes'>             </span><i><span style='color:#666666'>//period
contains 100 ticks --&gt;PWM frequency = 15kHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:black'>Motor0</span></b><span style='color:red'>(</span></span><span
style='color:#A900A9'>0</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:black'>Motor1</span></b><span style='color:red'>(</span></span><span
style='color:#A900A9'>0</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//reset
encoder counts</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>EncoderCount0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>EncoderCount1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//assume
motors are stopped, so timeout period calculation</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>EncoderTimeout0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>EncoderTimeout1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//set
motors as unlocked</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>curLockMode</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>UNLOCKED</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//use only for debugging, will invalidate <span class=SpellE><span
class=GramE>getState</span></span><span class=GramE>(</span>) function if <span
class=SpellE>callled</span></span></i><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_debugMove</span></b></span><span style='color:red'>(</span><span
class=SpellE><span style='color:blue'>int</span></span> <span style='color:
black'>duty1</span><span style='color:red'>,</span> <span class=SpellE><span
style='color:blue'>int</span></span> <span style='color:black'>duty0</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>duty0</span> <span
style='color:red'>!=</span> <span style='color:#A900A9'>0</span> <span
style='color:red'>||</span> <span style='color:black'>duty1</span> <span
style='color:red'>!=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span class=SpellE><span
class=GramE>disablePID</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>Motor0</span></b><span style='color:red'>(</span></span><span
style='color:black'>duty0</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:1'>    </span><span
class=GramE><b><span style='color:black'>Motor1</span></b><span
style='color:red'>(</span></span><span style='color:black'>duty1</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span class=SpellE><span
class=GramE>disablePID</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_debugPrint</span></b></span><span style='color:red'>(</span><span
style='color:blue'>char</span> <span class=SpellE><span style='color:black'>motorNum</span></span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//print
debugging information to the screen</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span class=SpellE>DIR_t</span>
myDir0</span><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>,</span><span style='font-size:10.0pt;font-family:"Courier New"'> <span
style='color:black'>myDir1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>char</span></span>
<span style='color:black'>myNewEdge0</span><span style='color:red'>,</span> <span
style='color:black'>myNewEdge1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>unsigned</span></span><span
style='color:blue'> <span class=SpellE>int</span></span> <span
style='color:black'>myUPeriod0</span><span style='color:red'>,</span> <span
style='color:black'>myUPeriod1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=SpellE><span class=GramE><span
style='color:blue'>int</span></span></span> <span style='color:black'>myDuty0</span><span
style='color:red'>,</span> <span style='color:black'>myDuty1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span class=SpellE>DisableInterrupts</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>;</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//retrieve
shared variables between encoder IC interrupt and this print statement</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myDir0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>dir0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myDir1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>dir1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myNewEdge0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>newEdge0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myNewEdge1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>newEdge1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myUPeriod0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>uPeriod0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myUPeriod1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>uPeriod1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myDuty0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>duty0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myDuty1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>duty1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span class=SpellE>EnableInterrupts</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>;</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span class=SpellE><span style='color:black'>motorNum</span></span>
<span style='color:red'>==</span> <span style='color:#A900A9'>0</span><span
style='color:red'>)</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>(</span><span
class=GramE><span style='color:blue'>void</span><span style='color:red'>)</span></span><span
class=SpellE><b><span style='color:black'>printf</span></b></span><span
style='color:red'>(&quot;curRPM0:%d, desRPM0:%d, duty0:%d, period0:%d</span><span
style='color:#FF00CC'>\r\n</span><span style='color:red'>&quot;,</span><span
style='color:black'>curSpd0</span><span style='color:red'>,</span> <span
style='color:black'>desSpd0</span><span style='color:red'>,</span> <span
style='color:black'>duty0</span><span style='color:red'>,</span> <span
style='color:black'>uPeriod0</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>(</span><span
class=GramE><span style='color:blue'>void</span><span style='color:red'>)</span></span><span
class=SpellE><b><span style='color:black'>printf</span></b></span><span
style='color:red'>(&quot;curRPM1:%d, desRPM1:%d, duty1:%d, period1:%d</span><span
style='color:#FF00CC'>\r\n</span><span style='color:red'>&quot;,</span><span
style='color:black'>curSpd1</span><span style='color:red'>,</span> <span
style='color:black'>desSpd1</span><span style='color:red'>,</span> <span
style='color:black'>duty1</span><span style='color:red'>,</span> <span
style='color:black'>uPeriod1</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_resetPosition</span></b></span><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//reset
encoder counts</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>EncoderCount0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>EncoderCount1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=SpellE><span style='font-size:10.0pt;
font-family:"Courier New";color:black'>MOTOR_State_t</span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_<span class=GramE>getState</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><span style='color:blue'>char</span></span>
<span class=SpellE><span style='color:black'>physicallyStopped</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><span style='color:blue'>char</span></span>
<span class=SpellE><span style='color:black'>controlStopped</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>controlStopped</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>= ((</span><span
style='color:black'>desSpd0</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>) &amp;&amp; (</span><span
style='color:black'>desSpd1</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>));</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>physicallyStopped</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>= ((</span><span
style='color:black'>curSpd0</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>) &amp;&amp; (</span><span
style='color:black'>curSpd1</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>));</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
class=SpellE><span style='color:black'>controlStopped</span></span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='mso-spacerun:yes'>  </span><span
class=GramE><b><span style='color:blue'>if</span></b></span> <span
style='color:red'>(</span><span class=SpellE><span style='color:black'>physicallyStopped</span></span><span
style='color:red'>)</span> <b><span style='color:blue'>return</span></b> <span
style='color:black'>MOTORS_STOPPED</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='mso-spacerun:yes'>  </span><span
class=GramE><b><span style='color:blue'>else</span></b></span><b><span
style='color:blue'> return</span></b> <span style='color:black'>MOTORS_STOPPING</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span><b><span style='color:blue'> return</span></b>
<span style='color:black'>MOTORS_MOVING</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>float</span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_getNetDistance</span></b></span><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//return
average of the encoder counts since last command</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>return</span></b></span> <span style='color:red'>(((</span><span
style='color:blue'>float</span><span style='color:red'>)</span><span
style='color:black'>EncoderCount0</span> <span style='color:red'>+ (</span><span
style='color:blue'>float</span><span style='color:red'>)</span><span
style='color:black'>EncoderCount1</span><span style='color:red'>)/(</span><span
style='color:#A900A9'>2</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>EncoderTicksPerInch</span></span><span
style='color:red'>));</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>float</span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_getDegreesTurned</span></b></span><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>float</span></span>
<span style='color:black'>temp</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span class=GramE>temp</span></span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
style='color:#A900A9'>360</span><span style='color:red'>*((</span><span
style='color:blue'>float</span><span style='color:red'>)</span><span
style='color:black'>EncoderCount0</span> <span style='color:red'>- (</span><span
style='color:blue'>float</span><span style='color:red'>)</span><span
style='color:black'>EncoderCount1</span><span style='color:red'>)/(</span><span
style='color:#A900A9'>2</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>EncoderTicksPerRev</span></span><span
style='color:red'>));</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>temp</span> <span style='color:red'>&lt;</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <span
style='color:black'>temp</span> <span style='color:red'>*= -</span><span
style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>return</span></b></span> <span style='color:black'>temp</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>long</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_getEncoderCount</span></b></span><span
style='color:red'>(</span><span class=SpellE><span style='color:blue'>int</span></span>
<span class=SpellE><span style='color:black'>motorNum</span></span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>   </span><span class=GramE><b><span style='color:
blue'>if</span></b></span> <span style='color:red'>(</span><span class=SpellE><span
style='color:black'>motorNum</span></span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <b><span
style='color:blue'>return</span></b> <span style='color:black'>EncoderCount0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>   </span><span class=GramE><b><span style='color:
blue'>else</span></b></span><b><span style='color:blue'> return</span></b> <span
style='color:black'>EncoderCount1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//assumes inputs speeds = [-100, 100]</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_moveDiff</span></b></span><span style='color:red'>(</span><span
class=SpellE><span style='color:blue'>int</span></span> <span style='color:
black'>spd1</span><span style='color:red'>,</span> <span class=SpellE><span
style='color:blue'>int</span></span> <span style='color:black'>spd0</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>disablePID</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:#A900A9'>1</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//temporarily turn off PID control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>spd0</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <span
style='color:black'>desSpd0</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>desSpd0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span style='color:red'>(</span><span
style='color:blue'>long</span><span style='color:red'>)</span><span
style='color:black'>spd0</span><span style='color:red'>*</span><span
style='color:black'>maxMotorSpeed</span><span style='color:red'>/</span><span
style='color:#A900A9'>100</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><i><span style='color:#666666'>//make
sure commanded speed isn't slower than min controllable speed</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desSpd0</span> <span style='color:red'>&gt;</span> <span
style='color:#A900A9'>0</span> <span style='color:red'>&amp;&amp;</span> <span
style='color:black'>desSpd0</span> <span style='color:red'>&lt;</span> <span
class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>)</span> <span style='color:black'>desSpd0</span> <span
style='color:red'>=</span> <span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desSpd0</span> <span style='color:red'>&lt;</span> <span
style='color:#A900A9'>0</span> <span style='color:red'>&amp;&amp;</span> <span
style='color:black'>desSpd0</span> <span style='color:red'>&gt; -</span><span
style='color:#A900A9'>1</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>)</span> <span style='color:black'>desSpd0</span> <span
style='color:red'>= -</span><span style='color:#A900A9'>1</span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>spd1</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <span
style='color:black'>desSpd1</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>desSpd1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span style='color:red'>(</span><span
style='color:blue'>long</span><span style='color:red'>)</span><span
style='color:black'>spd1</span><span style='color:red'>*</span><span
style='color:black'>maxMotorSpeed</span><span style='color:red'>/</span><span
style='color:#A900A9'>100</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><i><span style='color:#666666'>//make
sure commanded speed isn't slower than min controllable speed</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desSpd1</span> <span style='color:red'>&gt;</span> <span
style='color:#A900A9'>0</span> <span style='color:red'>&amp;&amp;</span> <span
style='color:black'>desSpd1</span> <span style='color:red'>&lt;</span> <span
class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>)</span> <span style='color:black'>desSpd1</span> <span
style='color:red'>=</span> <span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desSpd1</span> <span style='color:red'>&lt;</span> <span
style='color:#A900A9'>0</span> <span style='color:red'>&amp;&amp;</span> <span
style='color:black'>desSpd1</span> <span style='color:red'>&gt; -</span><span
style='color:#A900A9'>1</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>)</span> <span style='color:black'>desSpd1</span> <span
style='color:red'>= -</span><span style='color:#A900A9'>1</span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderFlag0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderFlag1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>spd1</span> <span style='color:red'>==</span> <span
style='color:black'>spd0</span><span style='color:red'>)</span> <span
class=SpellE><span style='color:black'>curLockMode</span></span> <span
style='color:red'>=</span> <span style='color:black'>LOCKED</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>spd1</span> <span style='color:red'>== -</span><span
style='color:#A900A9'>1</span><span style='color:red'>*</span><span
style='color:black'>spd0</span><span style='color:red'>)</span> <span
class=SpellE><span style='color:black'>curLockMode</span></span> <span
style='color:red'>=</span> <span style='color:black'>OPPOSITE</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span class=SpellE><span
style='color:black'>curLockMode</span></span> <span style='color:red'>=</span> <span
style='color:black'>UNLOCKED</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>disablePID</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//reengage PID control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_moveStraight</span></b></span><span
style='color:red'>(</span><span class=SpellE><span style='color:blue'>int</span></span>
<span class=SpellE><span style='color:black'>spd</span></span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=SpellE><b><span
style='color:black'>Motors_<span class=GramE>moveDiff</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span class=SpellE><span
style='color:black'>spd</span></span><span style='color:red'>,</span> <span
class=SpellE><span style='color:black'>spd</span></span><span style='color:
red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_turn</span></b></span><span style='color:red'>(</span><span
class=SpellE><span style='color:black'>MOTOR_TurnDir_t</span></span><span
style='color:black'> dir</span><span style='color:red'>,</span> <span
class=SpellE><span style='color:blue'>int</span></span> <span class=SpellE><span
style='color:black'>spd</span></span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>dir</span> <span style='color:red'>==</span> <span
style='color:black'>CW</span><span style='color:red'>)</span> <span
class=SpellE><b><span style='color:black'>Motors_moveDiff</span></b></span><span
style='color:red'>(</span><span class=SpellE><span style='color:black'>spd</span></span><span
style='color:red'>, -</span><span style='color:#A900A9'>1</span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>spd</span></span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span class=SpellE><b><span
style='color:black'>Motors_moveDiff</span></b></span><span style='color:red'>(-</span><span
style='color:#A900A9'>1</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>spd</span></span><span style='color:
red'>,</span> <span class=SpellE><span style='color:black'>spd</span></span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_moveStraightStop</span></b></span><span
style='color:red'>(</span><span class=SpellE><span style='color:blue'>int</span></span>
<span class=SpellE><span style='color:black'>spd</span></span><span
style='color:red'>,</span> <span style='color:blue'>float</span> <span
style='color:black'>inches</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><span style='color:blue'>float</span></span>
<span class=SpellE><span style='color:black'>myDistance</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
class=SpellE><span style='color:black'>spd</span></span> <span
style='color:red'>&lt;</span> <span style='color:#A900A9'>0</span><span
style='color:red'>)</span> <span class=SpellE><span style='color:black'>myDistance</span></span>
<span style='color:red'>= -</span><span style='color:#A900A9'>1</span><span
style='color:red'>*</span><span style='color:black'>inches</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span class=SpellE><span
style='color:black'>myDistance</span></span> <span style='color:red'>=</span> <span
style='color:black'>inches</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=SpellE><b><span
style='color:black'>Motors_<span class=GramE>moveDiff</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span class=SpellE><span
style='color:black'>spd</span><span style='color:red'>,</span><span
style='color:black'>spd</span></span><span style='color:red'>);</span> <i><span
style='color:#666666'>//set motor speeds</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=SpellE><b><span
style='color:black'>Motors_<span class=GramE>resetPosition</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span style='color:red'>);</span>
<i><span style='color:#666666'>//reset encoder counts</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//set
number of encoder counts to move</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderCount0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span class=SpellE><span style='color:black'>myDistance</span></span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>EncoderTicksPerInch</span></span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderCount1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span class=SpellE><span style='color:black'>myDistance</span></span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>EncoderTicksPerInch</span></span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderFlag0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//indicate wheel should stop after given # of encoder
counts</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderFlag1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Motors_turnStop</span></b></span><span style='color:red'>(</span><span
class=SpellE><span style='color:black'>MOTOR_TurnDir_t</span></span><span
style='color:black'> dir</span><span style='color:red'>,</span> <span
class=SpellE><span style='color:blue'>int</span></span> <span class=SpellE><span
style='color:black'>spd</span></span><span style='color:red'>,</span> <span
style='color:blue'>unsigned <span class=SpellE>int</span></span> <span
style='color:black'>degree</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><span style='color:blue'>long</span></span>
<span class=SpellE><span style='color:black'>myEncoderTicks</span></span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=SpellE><b><span
style='color:black'>Motors_<span class=GramE>turn</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span style='color:black'>dir</span><span
style='color:red'>,</span> <span class=SpellE><span style='color:black'>spd</span></span><span
style='color:red'>);</span> <i><span style='color:#666666'>//set motor speeds</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//set
number of encoder counts to move</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>myEncoderTicks</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>= ((</span><span
style='color:blue'>long</span><span style='color:red'>)</span><span
style='color:black'>degree</span><span style='color:red'>)*</span><span
style='color:black'>EncoderTicksPerRev</span><span style='color:red'>/</span><span
style='color:#A900A9'>360</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>dir</span> <span style='color:red'>==</span> <span
style='color:black'>CCW</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>desEncoderCount0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span class=SpellE><span style='color:black'>myEncoderTicks</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>desEncoderCount1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= -</span><span
style='color:#A900A9'>1</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>myEncoderTicks</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>desEncoderCount0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= -</span><span
style='color:#A900A9'>1</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>myEncoderTicks</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>desEncoderCount1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span class=SpellE><span style='color:black'>myEncoderTicks</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=SpellE><b><span
style='color:black'>Motors_<span class=GramE>resetPosition</span></span></b></span><span
class=GramE><span style='color:red'>(</span></span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderFlag0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//indicate wheel should stop after given # of encoder
counts</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>desEncoderFlag1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Initialize interrupts</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Encoder0 Channel <span class=GramE>A</span> is Timer 1, PT4</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Encoder1 Channel <span class=GramE>A</span> is Timer 1, PT6</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//OC for PID control is Timer 1 PT5</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span class=SpellE><b><span
style='color:black'>Timers_Init</span></b></span><span style='color:red'>(</span><span
style='color:blue'>void</span><span style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TSCR1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_TEN</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>    </span><i><span style='color:#666666'>//Turn on
timer system to allow IC</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TSCR2</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
style='color:black'>TIM1_TSCR2</span> <span style='color:red'>&amp; ~</span><span
style='color:black'>_S12_PR2</span><span style='color:red'>) |</span><span
style='color:black'>_S12_PR1</span> <span style='color:red'>|</span> <span
style='color:black'>_S12_PR0</span><span class=GramE><span style='color:red'>;</span><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>/</span></i></span><i><span
style='color:#666666'>/pre-scale /8 = 3MHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TIOS</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_IOS5</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//set Cap/Comp 5 to OC. Rest are IC.</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>/** <span
class=SpellE>InputCapture</span> with interrupt of Encoder0 Channel A.</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'><span style='mso-spacerun:yes'>      </span>Use Timer1 Channel4
set to PT4 on E128 **/</span></i><span style='font-size:10.0pt;font-family:
"Courier New";color:black'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TCTL3</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
style='color:black'>TIM1_TCTL3</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_EDG4B</span><span style='color:red'>) |</span> <span
style='color:black'>_S12_EDG4A</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>   </span><i><span style='color:#666666'>//capture
rising edges</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TFLG1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_C4F</span><span class=GramE><span
style='color:red'>;</span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>/</span></i></span><i><span style='color:#666666'>/Clear
IC4 flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TIE</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>|=</span>
<span style='color:black'>_S12_C4I</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>   </span><i><span style='color:#666666'>//Enable IC4
interrupt</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>/** <span
class=SpellE>InputCapture</span> with interrupt of Encoder1 Channel A.</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'><span style='mso-spacerun:yes'>      </span>Use Timer1 Channel6
set to PT6 on E128 **/</span></i><span style='font-size:10.0pt;font-family:
"Courier New";color:black'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TCTL3</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
style='color:black'>TIM1_TCTL3</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_EDG6B</span><span style='color:red'>) |</span> <span
style='color:black'>_S12_EDG6A</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>   </span><i><span style='color:#666666'>//capture
rising edges</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TFLG1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_C6F</span><span class=GramE><span
style='color:red'>;</span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>/</span></i></span><i><span style='color:#666666'>/Clear
IC4 flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TIE</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>|=</span>
<span style='color:black'>_S12_C6I</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>   </span><i><span style='color:#666666'>//Enable IC4
interrupt</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>/** <span
class=SpellE>OutputCompare</span> with interrupt on</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'><span style='mso-spacerun:yes'>      </span>Use Timer1 Channel5
set to PT5 on E128 **/</span></i><span style='font-size:10.0pt;font-family:
"Courier New";color:black'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TCTL1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TIM1_TCTL1</span> <span style='color:red'>&amp; <span
class=GramE>~(</span></span><span style='color:black'>_S12_OL5</span> <span
style='color:red'>|</span> <span style='color:black'>_S12_OM5</span><span
style='color:red'>);</span><span style='mso-spacerun:yes'>     </span><i><span
style='color:#666666'>//No pin connected for OC5</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TC5</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TIM1_TCNT</span> <span style='color:red'>+</span> <span
style='color:black'>TIME</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>       </span><i><span style='color:#666666'>//Schedule
first rise for OC</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TFLG1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_C5F</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>            </span><i><span style='color:#666666'>//Clear
OC5 flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TIE</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>|=</span>
<span style='color:black'>_S12_C5I</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>             </span><i><span style='color:#666666'>//Enable
OC5 interrupt</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span class=SpellE>EnableInterrupts</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>;</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//PID Control Interrupt Response Routine is called every 20 [ms]</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Measured runtime &lt; 200 [us]</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span style='color:black'>interrupt
_Vec_tim1ch5</span> <span class=SpellE><b><span style='color:black'>EncoderOC_PID_DC</span></b></span><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>static</span></span><span
style='color:blue'> long</span> <span style='color:black'>intErr0</span><span
style='color:red'>=</span><span style='color:#A900A9'>0</span><span
style='color:red'>,</span> <span style='color:black'>intErr1</span><span
style='color:red'>=</span><span style='color:#A900A9'>0</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//integrated errors</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>static</span></span><span
style='color:blue'> <span class=SpellE>int</span></span> <span
style='color:black'>lastCmdSpd0</span><span style='color:red'>=</span><span
style='color:#A900A9'>0</span><span style='color:red'>,</span> <span
style='color:black'>lastCmdSpd1</span><span style='color:red'>=</span><span
style='color:#A900A9'>0</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//last commanded speed for acceleration control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=SpellE><span class=GramE><span
style='color:blue'>int</span></span></span> <span style='color:black'>errSpd0</span><span
style='color:red'>,</span> <span style='color:black'>errSpd1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>long</span></span>
<span style='color:black'>errPos0</span><span style='color:red'>,</span> <span
style='color:black'>errPos1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>float</span></span>
<span class=SpellE><span style='color:black'>tempFloat</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=SpellE><span class=GramE><span
style='color:blue'>int</span></span></span> <span style='color:black'>curMaxDuty0</span><span
style='color:red'>,</span> <span style='color:black'>curMinDuty0</span><span
style='color:red'>,</span> <span style='color:black'>curMaxDuty1</span><span
style='color:red'>,</span> <span style='color:black'>curMinDuty1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=SpellE><span class=GramE><span
style='color:blue'>int</span></span></span> <span style='color:black'>cmdSpd0</span><span
style='color:red'>,</span> <span style='color:black'>cmdSpd1</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//these are same as
desired speed BUT with acceleration and position</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:4'>                        </span><i><span
style='color:#666666'>//control constraints imposed</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span class=SpellE>DIR_t</span>
myDir0</span><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>,</span><span style='font-size:10.0pt;font-family:"Courier New"'> <span
style='color:black'>myDir1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>char</span></span>
<span style='color:black'>myNewEdge0</span><span style='color:red'>,</span> <span
style='color:black'>myNewEdge1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>unsigned</span></span><span
style='color:blue'> <span class=SpellE>int</span></span> <span
style='color:black'>myUPeriod0</span><span style='color:red'>,</span> <span
style='color:black'>myUPeriod1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//PTT |=
BIT7HI<span class=GramE>;<span style='mso-spacerun:yes'>  </span>/</span>/debugging</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//retrieve
shared variables between encoder IC interrupt and this OC control interrupt</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myDir0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>dir0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myDir1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>dir1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myNewEdge0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>newEdge0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myNewEdge1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>newEdge1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myUPeriod0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>uPeriod0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>myUPeriod1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>uPeriod1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//write shared
variables</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>newEdge0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>newEdge1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>myNewEdge0</span> <span
style='color:red'>==</span> <span style='color:#A900A9'>0</span><span
style='color:red'>)</span> <span style='color:black'>EncoderTimeout0</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>myNewEdge1</span> <span
style='color:red'>==</span> <span style='color:#A900A9'>0</span><span
style='color:red'>)</span> <span style='color:black'>EncoderTimeout1</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TFLG1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_C5F</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>          </span><i><span style='color:#666666'>//Clear
OC5 flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TC5</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TIM1_TCNT</span> <span style='color:red'>+</span> <span
style='color:black'>TIME</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>    </span><i><span style='color:#666666'>//Program
next compare</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span class=SpellE>EnableInterrupts</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>;</span><span
style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>               </span><i><span style='color:#666666'>//Call
to ensure Encoder IC interrupts</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//check if
commanding duty cycle directly for debugging purposes</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span class=SpellE><span style='color:black'>disablePID</span></span>
<span style='color:red'>==</span> <span style='color:#A900A9'>1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>//do not <span class=GramE>implement</span> PID control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='mso-spacerun:yes'>  </span><span
class=GramE><b><span style='color:blue'>return</span></b></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//convert <span
class=SpellE>uPeriods</span> to speeds [RPM]</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>myNewEdge0</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <span
style='color:black'>curSpd0</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>curSpd0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span style='color:red'>(</span><span
style='color:blue'>long</span><span style='color:red'>)</span><span
style='color:#A900A9'>1800000</span><span style='color:red'>/</span><span
style='color:black'>myUPeriod0</span><span style='color:red'>);</span> <i><span
style='color:#666666'>// motor speed</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>myDir0</span> <span style='color:red'>==</span> <span
style='color:black'>BACKWARD</span><span style='color:red'>)</span> <span
style='color:black'>curSpd0</span> <span style='color:red'>*= -</span><span
style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>myNewEdge1</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <span
style='color:black'>curSpd1</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>curSpd1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span style='color:red'>(</span><span
style='color:blue'>long</span><span style='color:red'>)</span><span
style='color:#A900A9'>1800000</span><span style='color:red'>/</span><span
style='color:black'>myUPeriod1</span><span style='color:red'>);</span> <i><span
style='color:#666666'>// motor speed</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>myDir1</span><span style='color:red'>==</span> <span
style='color:black'>BACKWARD</span><span style='color:red'>)</span> <span
style='color:black'>curSpd1</span> <span style='color:red'>*= -</span><span
style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>cmdSpd0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>desSpd0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>cmdSpd1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>desSpd1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Determine Commanded Speed for Motor1 (slower motor)</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//Calc
speed limit based on nearing end position</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desEncoderFlag1</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>1</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>errPos1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>desEncoderCount1</span> <span style='color:red'>-</span>
<span style='color:black'>EncoderCount1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><i><span style='color:#666666'>//calculate
<span class=SpellE>cmd</span> speed based off this error</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>errPos1</span> <span style='color:red'>&lt;</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <span
style='color:black'>cmdSpd1</span> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span style='color:red'>)(</span><span
class=SpellE><span style='color:black'>Kp_Pos</span></span><span
style='color:red'>*</span><span style='color:black'>errPos1</span><span
style='color:red'>) -</span> <span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:black'>cmdSpd1</span>
<span style='color:red'>= (</span><span class=SpellE><span style='color:blue'>int</span></span><span
style='color:red'>)(</span><span class=SpellE><span style='color:black'>Kp_Pos</span></span><span
style='color:red'>*</span><span style='color:black'>errPos1</span><span
style='color:red'>) +</span> <span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desSpd1</span> <span style='color:red'>&gt;=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span class=GramE><b><span
style='color:blue'>if</span></b><span style='color:red'>(</span></span><span
style='color:red'>(</span><span style='color:black'>cmdSpd1</span> <span
style='color:red'>&gt;</span> <span style='color:black'>desSpd1</span><span
style='color:red'>) || (</span><span style='color:black'>cmdSpd1</span> <span
style='color:red'>&lt;</span> <span style='color:#A900A9'>0</span><span
style='color:red'>))</span> <span style='color:black'>cmdSpd1</span> <span
style='color:red'>=</span> <span style='color:black'>desSpd1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span class=GramE><b><span
style='color:blue'>if</span></b><span style='color:red'>(</span></span><span
style='color:red'>(</span><span style='color:black'>cmdSpd1</span> <span
style='color:red'>&lt;</span> <span style='color:black'>desSpd1</span><span
style='color:red'>) || (</span><span style='color:black'>cmdSpd1</span> <span
style='color:red'>&gt;</span> <span style='color:#A900A9'>0</span><span
style='color:red'>))</span> <span style='color:black'>cmdSpd1</span> <span
style='color:red'>=</span> <span style='color:black'>desSpd1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//Calc
speed limit based on acceleration limits</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//if
((cmdSpd1 - lastCmdSpd1) &gt; <span class=SpellE>maxPosAccel</span>) cmdSpd1 =
lastCmdSpd1 + <span class=SpellE>maxPosAccel</span>;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//else if
((cmdSpd1 - lastCmdSpd1) &lt; -1*<span class=SpellE>maxNegAccel</span>) cmdSpd1
= lastCmdSpd1 - <span class=SpellE>maxNegAccel</span>;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Determine Commanded Speed for Motor0 (faster motor)</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
class=SpellE><span style='color:black'>curLockMode</span></span> <span
style='color:red'>==</span> <span style='color:black'>LOCKED</span><span
style='color:red'>)</span> <span style='color:black'>cmdSpd0</span> <span
style='color:red'>=</span> <span style='color:black'>cmdSpd1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span><b><span style='color:blue'> if</span></b>
<span style='color:red'>(</span><span class=SpellE><span style='color:black'>curLockMode</span></span>
<span style='color:red'>==</span> <span style='color:black'>OPPOSITE</span><span
style='color:red'>)</span> <span style='color:black'>cmdSpd0</span> <span
style='color:red'>= -</span><span style='color:#A900A9'>1</span><span
style='color:red'>*</span><span style='color:black'>cmdSpd1</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><i><span style='color:#666666'>//Calc
speed limit based on nearing end position</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desEncoderFlag0</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>1</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><i><span style='color:#666666'>//calculate
position error</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><i><span style='color:#666666'>//this
error should NEVER be zero (or we wouldn't be in position control mode)</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>errPos0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>desEncoderCount0</span> <span style='color:red'>-</span>
<span style='color:black'>EncoderCount0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><i><span style='color:#666666'>//calculate
<span class=SpellE>cmd</span> speed based off this error</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>errPos0</span> <span style='color:red'>&lt;</span> <span
style='color:#A900A9'>0</span><span style='color:red'>)</span> <span
style='color:black'>cmdSpd0</span> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span style='color:red'>)(</span><span
class=SpellE><span style='color:black'>Kp_Pos</span></span><span
style='color:red'>*</span><span style='color:black'>errPos0</span><span
style='color:red'>) -</span> <span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:black'>cmdSpd0</span>
<span style='color:red'>= (</span><span class=SpellE><span style='color:blue'>int</span></span><span
style='color:red'>)(</span><span class=SpellE><span style='color:black'>Kp_Pos</span></span><span
style='color:red'>*</span><span style='color:black'>errPos0</span><span
style='color:red'>) +</span> <span class=SpellE><span style='color:black'>minControlRPM</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><i><span style='color:#666666'>//<span
class=SpellE>cmdSpd</span> from position control should only limit <span
class=SpellE>desSpd</span>, never increase it</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>desSpd0</span> <span style='color:red'>&gt;=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:4'>                        </span><span class=GramE><b><span
style='color:blue'>if</span></b><span style='color:red'>(</span></span><span
style='color:red'>(</span><span style='color:black'>cmdSpd0</span> <span
style='color:red'>&gt;</span> <span style='color:black'>desSpd0</span><span
style='color:red'>) || (</span><span style='color:black'>cmdSpd0</span> <span
style='color:red'>&lt;</span> <span style='color:#A900A9'>0</span><span
style='color:red'>))</span> <span style='color:black'>cmdSpd0</span> <span
style='color:red'>=</span> <span style='color:black'>desSpd0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:4'>                        </span><span class=GramE><b><span
style='color:blue'>if</span></b><span style='color:red'>(</span></span><span
style='color:red'>(</span><span style='color:black'>cmdSpd0</span> <span
style='color:red'>&lt;</span> <span style='color:black'>desSpd0</span><span
style='color:red'>) || (</span><span style='color:black'>cmdSpd0</span> <span
style='color:red'>&gt;</span> <span style='color:#A900A9'>0</span><span
style='color:red'>))</span> <span style='color:black'>cmdSpd0</span> <span
style='color:red'>=</span> <span style='color:black'>desSpd0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:3'>                  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><i><span style='color:#666666'>//Calc
speed limit based on acceleration limits</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><i><span style='color:#666666'>//if
((cmdSpd0 - lastCmdSpd0) &gt; <span class=SpellE>maxPosAccel</span>) cmdSpd0 =
lastCmdSpd0 + <span class=SpellE>maxPosAccel</span>;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><i><span style='color:#666666'>//else
if ((cmdSpd0 - lastCmdSpd0) &lt; -1*<span class=SpellE>maxNegAccel</span>)
cmdSpd0 = lastCmdSpd0 - <span class=SpellE>maxNegAccel</span>;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//update
for last <span class=SpellE>cmd</span> speed for <span class=SpellE>acceration</span>
limit purposes</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>lastCmdSpd0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>cmdSpd0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>lastCmdSpd1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>cmdSpd1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//determine
speed error for PID control of speed</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>errSpd0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>cmdSpd0</span> <span style='color:red'>-</span> <span
style='color:black'>curSpd0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>errSpd1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>cmdSpd1</span> <span style='color:red'>-</span> <span
style='color:black'>curSpd1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>intErr0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>+=</span>
<span style='color:black'>errSpd0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>intErr1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>+=</span>
<span style='color:black'>errSpd1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//calculate
authority</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>tempFloat</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
class=SpellE><span style='color:black'>Kp</span></span><span style='color:red'>*</span><span
style='color:black'>errSpd0</span> <span style='color:red'>+</span> <span
class=SpellE><span style='color:black'>Ki</span></span><span style='color:red'>*</span><span
style='color:black'>intErr0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>duty0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)</span><span class=SpellE><span style='color:black'>tempFloat</span></span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>tempFloat</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
class=SpellE><span style='color:black'>Kp</span></span><span style='color:red'>*</span><span
style='color:black'>errSpd1</span> <span style='color:red'>+</span> <span
class=SpellE><span style='color:black'>Ki</span></span><span style='color:red'>*</span><span
style='color:black'>intErr1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>duty1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)</span><span class=SpellE><span style='color:black'>tempFloat</span></span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//quick
check for zero duty</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>((</span><span
style='color:black'>curSpd0</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>) &amp;&amp; (</span><span
style='color:black'>cmdSpd0</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>))</span> <span
style='color:black'>duty0</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>((</span><span
style='color:black'>curSpd1</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>) &amp;&amp; (</span><span
style='color:black'>cmdSpd1</span> <span style='color:red'>==</span> <span
style='color:#A900A9'>0</span><span style='color:red'>))</span> <span
style='color:black'>duty1</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//Calculate
authority limit for both motors (based on speed-&gt;<span class=SpellE>backEMF</span>)</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>tempFloat</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>curSpd0</span><span style='color:red'>/</span><span
style='color:#A900A9'>407</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//calculate back EMF</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>curMaxDuty0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span> <span style='color:#A900A9'>157</span> <span
style='color:red'>+</span> <span style='color:#A900A9'>12.5</span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>tempFloat</span></span><span
style='color:red'>);</span> <i><span style='color:#666666'>//(( Imax*<span
class=SpellE>Rcoils</span>) + EMF)*200[Duty Cycle]/16[V];</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>curMinDuty0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span style='color:red'>-</span><span
style='color:#A900A9'>157</span> <span style='color:red'>+</span> <span
style='color:#A900A9'>12.5</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>tempFloat</span></span><span
style='color:red'>);</span> <i><span style='color:#666666'>//((-Imax*<span
class=SpellE>Rcoils</span>) + EMF)*200/16;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>curMaxDuty0</span> <span style='color:red'>&gt;</span><span
style='mso-spacerun:yes'>  </span><span style='color:#A900A9'>200</span><span
style='color:red'>)</span> <span style='color:black'>curMaxDuty0</span> <span
style='color:red'>=</span><span style='mso-spacerun:yes'>  </span><span
style='color:#A900A9'>200</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>curMinDuty0</span> <span style='color:red'>&lt; -</span><span
style='color:#A900A9'>200</span><span style='color:red'>)</span> <span
style='color:black'>curMinDuty0</span> <span style='color:red'>= -</span><span
style='color:#A900A9'>200</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span class=SpellE><span
class=GramE>tempFloat</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>curSpd1</span><span style='color:red'>/</span><span
style='color:#A900A9'>407</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//calculate back EMF</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>curMaxDuty1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span> <span style='color:#A900A9'>157</span> <span
style='color:red'>+</span> <span style='color:#A900A9'>12.5</span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>tempFloat</span></span><span
style='color:red'>);</span> <i><span style='color:#666666'>//(( Imax*<span
class=SpellE>Rcoils</span>) + EMF)*200/16;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>curMinDuty1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
class=SpellE><span style='color:blue'>int</span></span><span class=GramE><span
style='color:red'>)(</span></span><span style='color:red'>-</span><span
style='color:#A900A9'>157</span> <span style='color:red'>+</span> <span
style='color:#A900A9'>12.5</span><span style='color:red'>*</span><span
class=SpellE><span style='color:black'>tempFloat</span></span><span
style='color:red'>);</span> <i><span style='color:#666666'>//((-Imax*<span
class=SpellE>Rcoils</span>) + EMF)*200/16;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>curMaxDuty1</span> <span style='color:red'>&gt;</span><span
style='mso-spacerun:yes'>  </span><span style='color:#A900A9'>200</span><span
style='color:red'>)</span> <span style='color:black'>curMaxDuty1</span> <span
style='color:red'>=</span><span style='mso-spacerun:yes'>  </span><span
style='color:#A900A9'>200</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>curMinDuty1</span> <span style='color:red'>&lt; -</span><span
style='color:#A900A9'>200</span><span style='color:red'>)</span> <span
style='color:black'>curMinDuty1</span> <span style='color:red'>= -</span><span
style='color:#A900A9'>200</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//saturate
duty cycle and prevent integrator wind-up</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>duty0</span> <span style='color:red'>&lt;</span> <span
style='color:black'>curMinDuty0</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>duty0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>curMinDuty0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>intErr0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>-=</span>
<span style='color:black'>errSpd0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>duty0</span> <span style='color:red'>&gt;</span> <span
style='color:black'>curMaxDuty0</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>duty0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>curMaxDuty0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>intErr0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>-=</span>
<span style='color:black'>errSpd0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>duty1</span> <span style='color:red'>&lt;</span> <span
style='color:black'>curMinDuty1</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>duty1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>curMinDuty1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>intErr1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>-=</span>
<span style='color:black'>errSpd1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:blue'>else</span></b></span> <span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>duty1</span> <span style='color:red'>&gt;</span> <span
style='color:black'>curMaxDuty1</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>duty1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>curMaxDuty1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>intErr1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>-=</span>
<span style='color:black'>errSpd1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//update
duty cycle to implement speed control</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:black'>Motor0</span></b><span style='color:red'>(</span></span><span
style='color:black'>duty0</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span class=GramE><b><span
style='color:black'>Motor1</span></b><span style='color:red'>(</span></span><span
style='color:black'>duty1</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><i><span style='color:#666666'>//PTT
&amp;= BIT7LO;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Encoder0 Channel <span class=GramE>A</span> tick interrupt for
Motor 0</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Interrupt Response Routine is called when TFLG1bit4 is set</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//meaning interrupt of rising edge has occurred</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span style='color:black'>interrupt
_Vec_tim1ch4</span> <b><span style='color:black'>Encoder0ICRoutine</span></b><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>static</span></span><span
style='color:blue'> unsigned <span class=SpellE>int</span></span> <span
style='color:black'>lastEdge0</span><span style='color:red'>,</span> <span
class=SpellE><span style='color:black'>tempPeriodCalc</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>static</span></span><span
style='color:blue'> <span class=SpellE>int</span></span> <span class=SpellE><span
style='color:black'>i</span></span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TFLG1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_C4F</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>               </span><i><span style='color:#666666'>//Clear
IC4 flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>EncoderTimeout0</span>
<span style='color:red'>==</span> <span style='color:#A900A9'>1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>EncoderTimeout0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//can't make period calculation until a second pulse is
received</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span>
<span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span class=SpellE><span
class=GramE>tempPeriodCalc</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>TIM1_TC4</span> <span style='color:red'>-</span> <span
style='color:black'>lastEdge0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><i><span style='color:#666666'>//check to
make sure period calculation is realistic</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>((</span><span
class=SpellE><span style='color:black'>tempPeriodCalc</span></span> <span
style='color:red'>&lt;</span> <span class=SpellE><span style='color:black'>minUPeriod</span></span><span
style='color:red'>) || (</span><span class=SpellE><span style='color:black'>tempPeriodCalc</span></span>
<span style='color:red'>&gt;</span> <span class=SpellE><span style='color:black'>maxUPeriod</span></span><span
style='color:red'>)) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><i><span style='color:#666666'>//ignore
this edge, must be noise</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span class=GramE><b><span
style='color:blue'>return</span></b></span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>uPeriod0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span class=SpellE><span style='color:black'>tempPeriodCalc</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>newEdge0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//flag that an encoder tick has <span class=SpellE>occured</span></span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//capture last
edge timing</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>lastEdge0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TIM1_TC4</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>PTP</span> <span
style='color:red'>&amp;</span> <span style='color:black'>BIT4HI</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'>  </span>EncoderCount0</span><span style='font-size:
10.0pt;font-family:"Courier New";color:red'>--;</span><span style='font-size:
10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'>  </span>dir0</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>BACKWARD</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>//<span class=SpellE><span class=GramE>printf</span></span><span
class=GramE>(</span>&quot;BACKWARD0\r\n&quot;); //remove</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span>
<span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'>  </span>EncoderCount0</span><span style='font-size:
10.0pt;font-family:"Courier New";color:red'>++;</span><span style='font-size:
10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>dir0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>FORWARD</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//check if
motor should stop MOTORS_MOVING</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>desEncoderFlag0</span>
<span style='color:red'>==</span> <span style='color:#A900A9'>1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:1'>    </span><span
class=GramE><b><span style='color:blue'>if</span></b></span> <span
style='color:red'>(</span><span style='color:black'>desEncoderCount0</span> <span
style='color:red'>==</span> <span style='color:black'>EncoderCount0</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span style='mso-tab-count:
2'>          </span>desSpd0</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//stop the motor</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span style='mso-tab-count:
2'>          </span>desEncoderFlag0</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
class=SpellE><span style='color:black'>curLockMode</span></span> <span
style='color:red'>!=</span> <span style='color:black'>UNLOCKED</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>desSpd1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>desEncoderFlag1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Encoder <span class=GramE>tick interrupt</span> for Motor 1</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Interrupt Response Routine is called when TFLG1bit6 is set</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//meaning interrupt of rising edge has occurred</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>void</span></span><span style='font-size:
10.0pt;font-family:"Courier New"'> <span style='color:black'>interrupt
_Vec_tim1ch6</span> <b><span style='color:black'>Encoder1ICRoutine</span></b><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>static</span></span><span
style='color:blue'> <span class=SpellE>int</span></span> <span class=SpellE><span
style='color:black'>i</span></span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><span style='color:blue'>static</span></span><span
style='color:blue'> unsigned <span class=SpellE>int</span></span> <span
style='color:black'>lastEdge1</span><span style='color:red'>,</span> <span
class=SpellE><span style='color:black'>tempPeriodCalc</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>TIM1_TFLG1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>_S12_C6F</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//Clear IC5 flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>EncoderTimeout1</span>
<span style='color:red'>==</span> <span style='color:#A900A9'>1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>EncoderTimeout1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//can't make period calculation until a second pulse is
received</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span>
<span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span class=SpellE><span
class=GramE>tempPeriodCalc</span></span></span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>TIM1_TC6</span> <span style='color:red'>-</span> <span
style='color:black'>lastEdge1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>((</span><span
class=SpellE><span style='color:black'>tempPeriodCalc</span></span> <span
style='color:red'>&lt;</span> <span class=SpellE><span style='color:black'>minUPeriod</span></span><span
style='color:red'>) || (</span><span class=SpellE><span style='color:black'>tempPeriodCalc</span></span>
<span style='color:red'>&gt;</span> <span class=SpellE><span style='color:black'>maxUPeriod</span></span><span
style='color:red'>)) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><i><span style='color:#666666'>//ignore
this edge, must be noise</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span class=GramE><b><span
style='color:blue'>return</span></b></span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>uPeriod1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span class=SpellE><span style='color:black'>tempPeriodCalc</span></span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>newEdge1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span> <i><span
style='color:#666666'>//flag that an encoder tick has <span class=SpellE>occured</span></span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>lastEdge1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TIM1_TC6</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>PTP</span> <span
style='color:red'>&amp;</span> <span style='color:black'>BIT5HI</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'> </span>EncoderCount1</span><span style='font-size:
10.0pt;font-family:"Courier New";color:red'>++;</span><span style='font-size:
10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'> </span>dir1</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>FORWARD</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span>
<span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'> </span>EncoderCount1</span><span style='font-size:
10.0pt;font-family:"Courier New";color:red'>--;</span><span style='font-size:
10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'> </span>dir1</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>=</span> <span
style='color:black'>BACKWARD</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//check if
motor should stop MOTORS_MOVING</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b></span>
<span style='color:red'>(</span><span style='color:black'>desEncoderFlag1</span>
<span style='color:red'>==</span> <span style='color:#A900A9'>1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:1'>    </span><span
class=GramE><b><span style='color:blue'>if</span></b></span> <span
style='color:red'>(</span><span style='color:black'>desEncoderCount1</span> <span
style='color:red'>==</span> <span style='color:black'>EncoderCount1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span><span style='mso-tab-count:
2'>          </span>desSpd1</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span> <i><span style='color:#666666'>//stop the motor</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:2'>            </span>desEncoderFlag1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
class=SpellE><span style='color:black'>curLockMode</span></span> <span
style='color:red'>!=</span> <span style='color:black'>UNLOCKED</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>desSpd0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:3'>                  </span>desEncoderFlag0</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:2'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//set duty cycle on motor 0 = where duty = [0, 200]</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span><span class=GramE><span style='color:blue'>static</span></span><span
style='color:blue'> void</span> <b><span style='color:black'>Motor0</span></b><span
style='color:red'>(</span><span class=SpellE><span style='color:blue'>int</span></span>
<span class=SpellE><span style='color:black'>inputDC</span></span><span
style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=SpellE><span class=GramE><span
style='color:blue'>int</span></span></span> <span style='color:black'>DC</span>
<span style='color:red'>= -</span><span style='color:#A900A9'>1</span><span
style='color:red'>*</span><span class=SpellE><span style='color:black'>inputDC</span></span><span
style='color:red'>;</span> <i><span style='color:#666666'>// motor 1 needs to
spin &quot;backwards&quot; for the <span class=SpellE>bot</span> to go forward</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b><span
style='color:red'>(</span></span><span style='color:black'>DC</span> <span
style='color:red'>&gt;</span> <span style='color:#A900A9'>0</span><span
style='color:red'>){</span><span style='mso-spacerun:yes'>           </span><i><span
style='color:#666666'>//CW</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PTP</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>&amp;=
~</span><span style='color:black'>DCMOTOR0</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>    </span><i><span style='color:#666666'>//PTT = PTT
&amp; BIT0LO</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM0DutyCycle</span></b><span style='color:red'>(</span></span><span
style='color:black'>DC</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span><b><span
style='color:blue'> if</span></b> <span style='color:red'>(</span><span
style='color:black'>DC</span> <span style='color:red'>&lt;</span> <span
style='color:#A900A9'>0</span><span style='color:red'>){</span><span
style='mso-spacerun:yes'>     </span><i><span style='color:#666666'>//CCW</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PTP</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>|=</span>
<span style='color:black'>DCMOTOR0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM0DutyCycle</span></b><span style='color:red'>(</span></span><span
style='color:#A900A9'>200</span><span style='color:red'>+</span><span
style='color:black'>DC</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span>
<span style='color:red'>{</span><span style='mso-spacerun:yes'>               
</span><i><span style='color:#666666'>//stop</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PTP</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>&amp;=
~</span><span style='color:black'>DCMOTOR0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM0DutyCycle</span></b><span style='color:red'>(</span></span><span
style='color:black'>DC</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//set duty cycle on motor 1</span></i><span style='font-size:
10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span class=GramE><span style='font-size:10.0pt;
font-family:"Courier New";color:blue'>static</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:blue'> void</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <b><span style='color:black'>Motor1</span></b><span
style='color:red'>(</span><span class=SpellE><span style='color:blue'>int</span></span>
<span style='color:black'>DC</span><span style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//motor 1 is
slower than motor 0</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>if</span></b><span
style='color:red'>(</span></span><span style='color:black'>DC</span> <span
style='color:red'>&gt;</span> <span style='color:#A900A9'>0</span><span
style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>DC</span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>+=</span><span
class=SpellE><span style='font-size:10.0pt;font-family:"Courier New";
color:black'>DutyOffset</span></span><span style='font-size:10.0pt;font-family:
"Courier New";color:red'>;</span><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>DC</span> <span style='color:red'>&gt;</span> <span
style='color:#A900A9'>200</span><span style='color:red'>)</span> <span
style='color:black'>DC</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>200</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PTP</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>&amp;=
~</span><span style='color:black'>DCMOTOR1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM1DutyCycle</span></b><span style='color:red'>(</span></span><span
style='color:black'>DC</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span><b><span
style='color:blue'> if</span></b> <span style='color:red'>(</span><span
style='color:black'>DC</span> <span style='color:red'>&lt;</span> <span
style='color:#A900A9'>0</span><span style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><st1:State w:st="on"><st1:place
 w:st="on">DC<span style='color:red'>-</span></st1:place></st1:State><span
style='color:red'>=</span><span class=SpellE>DutyOffset</span></span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>;</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:blue'>if</span></b></span> <span style='color:red'>(</span><span
style='color:black'>DC</span> <span style='color:red'>&lt; -</span><span
style='color:#A900A9'>200</span><span style='color:red'>)</span> <span
style='color:black'>DC</span> <span style='color:red'>= -</span><span
style='color:#A900A9'>200</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PTP</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>|=</span>
<span style='color:black'>DCMOTOR1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM1DutyCycle</span></b><span style='color:red'>(</span></span><span
style='color:#A900A9'>200</span><span style='color:red'>+</span><span
style='color:black'>DC</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span class=GramE><b><span style='color:blue'>else</span></b></span>
<span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>PTP</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>&amp;=
~</span><span style='color:black'>DCMOTOR1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span class=GramE><b><span
style='color:black'>setPWM1DutyCycle</span></b><span style='color:red'>(</span></span><span
style='color:black'>DC</span><span style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;mso-pagination:none;background:white;mso-layout-grid-align:none;
text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

</div>

</body>

</html>
