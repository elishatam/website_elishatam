<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="SPIC_files/filelist.xml">
<title>//#define TEST</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>6 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>3</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:ValidateAgainstSchemas>false</w:ValidateAgainstSchemas>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotUnderlineInvalidXML/>
  <w:DoNotShadeFormData/>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:AdjustLineHeightInTable/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
   <w:SelectEntireFieldWithStartOrEnd/>
   <w:UseWord2002TableStyleRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:841.85pt 1190.55pt;
	margin:56.7pt 56.7pt 56.7pt 56.7pt;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1026"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in;text-justify-trim:punctuation'>

<div class=Section1>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//#define TEST</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/**************************************************************************</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>SPI.c</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>ME 218B Project Hats Off</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>Team Firefox</span></i><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>March 7, 2010</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>The E128 queries the Target Commander over SPI for command
instructions</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>We are only querying the TC with 0xAA and 0xEx. We do not send
0xBx.</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>LED blinking begins here until TC sends the first active target</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>E128 = master</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>Target Commander = slave</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>***************************************************************************/</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Include Files
-----------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#include</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:red'>&quot;SPI.h&quot;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#include</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:red'>&quot;myTimer.h&quot;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#pragma LINK_INFO DERIVATIVE</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:red'>&quot;SampleS12&quot;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#define printf (void)printf</span><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Module Variables
-----------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>SPI_Status_t state</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static unsigned char</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:black'>lastCmd</span><span
style='color:red'>;</span><span style='mso-spacerun:yes'>        </span><i><span
style='color:#666666'>//Last written byte</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static unsigned char</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <span style='color:black'>receivedByte</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static unsigned int</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:black'>lastWriteTime</span><span
style='color:red'>;</span><span style='mso-spacerun:yes'>   </span><i><span
style='color:#666666'>//lastAATime, lastExTime;</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Stores the activated beacon into an array when TC sends new
beacons</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>ActivatedBeacons</span><span style='color:red'>[] =
{-</span><span style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>, -</span><span
style='color:#A900A9'>1</span><span style='color:red'>};</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static unsigned int</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:black'>curBeaconIndex</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static unsigned int</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:black'>lastActiveBeaconIndex</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>isCurBeaconHit</span> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>,</span> <span
style='color:black'>blinkState</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>requestedTargetStatus</span> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:black'>unreadTargetStatus</span> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>static unsigned int</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:black'>blinkTime</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>0</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Module Prototypes
-----------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>unsigned char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>firstLetter</span></b><span style='color:red'>(</span><span
style='color:blue'>unsigned char</span> <span style='color:black'>inByte</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>unsigned char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>lastLetter</span></b><span style='color:red'>(</span><span
style='color:blue'>unsigned char</span> <span style='color:black'>inByte</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>void</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>WriteByte</span></b><span style='color:red'>(</span><span
style='color:blue'>unsigned char</span> <span style='color:black'>myByte</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>/*-------------------------- Module Code
-------------------------------*/</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Debug function</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>void</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>debug_printActiveBeacons</span></b><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>int</span> <span
style='color:black'>a</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>for</span></b><span
style='color:red'>(</span><span style='color:black'>a</span><span
style='color:red'>=</span><span style='color:#A900A9'>0</span><span
style='color:red'>;</span> <span style='color:black'>a</span><span
style='color:red'>&lt;</span><span style='color:#A900A9'>15</span><span
style='color:red'>;</span> <span style='color:black'>a</span><span
style='color:red'>++){</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;%d &quot;,</span> <span style='color:black'>ActivatedBeacons</span><span
style='color:red'>[</span><span style='color:black'>a</span><span
style='color:red'>]);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;curBeaconIndex = %d</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;,</span> <span style='color:black'>curBeaconIndex</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Increment the curBeaconIndex in ActivatedBeacons array</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>void</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>SPI_skipCurTarget</span></b><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>curBeaconIndex</span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>++;</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>(</span><span style='color:black'>curBeaconIndex</span> <span
style='color:red'>&gt;</span> <span style='color:#A900A9'>15</span><span
style='color:red'>)</span> <span style='color:black'>curBeaconIndex</span> <span
style='color:red'>=</span> <span style='color:#A900A9'>15</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//returns the current active target</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>SPI_getCurTarget</span></b><span style='color:
red'>(</span><span style='color:blue'>void</span><span style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>return</span></b>
<span style='color:black'>ActivatedBeacons</span><span style='color:red'>[</span><span
style='color:black'>curBeaconIndex</span><span style='color:red'>];</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>SPI_isCurTargetHit</span></b><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>unreadTargetStatus</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>return</span></b>
<span style='color:black'>isCurBeaconHit</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>void</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>SPI_requestTargetStatus</span></b><span
style='color:red'>(</span><span style='color:blue'>void</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>requestedTargetStatus</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TRUE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>unreadTargetStatus</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Initialize the SPI. Set Baud Rate to 24.41kHz.</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Set Active edge as even rising edge and MSB transfer first</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>void</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>SPI_Init</span></b><span style='color:red'>(</span><span
style='color:blue'>void</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:black'>MyTimer_Init</span></b><span
style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPIBR</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0x77</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>                   </span><i><span style='color:#666666'>//1.
Set Baud Rate with SPPR &amp; SPR bits in SPIBR</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:1'>      </span><span
style='mso-spacerun:yes'>                                </span><i><span
style='color:#666666'>//12.21kHz</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPICR1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR1</span> <span style='color:red'>|</span> <span
style='color:black'>_S12_CPOL</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>    </span><i><span style='color:#666666'>//2.
Initialize CPOL and CPHA bits in SPICR1.</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPICR1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR1</span> <span style='color:red'>|</span> <span
style='color:black'>_S12_CPHA</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>    </span><i><span style='color:#666666'>//CPOL = 1,
CPHA = 1 for even rising active edge</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPICR1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR1</span> <span style='color:red'>|</span> <span
style='color:black'>_S12_MSTR</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>    </span><i><span style='color:#666666'>//3. Enable
Master. Set MSTR in SPICR1</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//<span style='mso-tab-count:1'>    </span>SPICR1 = SPICR1 |
_S12_SPIE;<span style='mso-spacerun:yes'>    </span>//4. Interrupts. Set SPIE,
SPTIE bits in SPICR1</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-tab-count:6'>                                    </span><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//(Locally
enable interrupts)</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPICR1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR1</span> <span style='color:red'>|</span> <span
style='color:black'>_S12_SPE</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>     </span><i><span style='color:#666666'>//5. Enable
SPI. Set SPE bits in SPICR1</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPICR1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR1</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_LSFBE</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//Set MSB
transfer first. (MSB already default)</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPICR1</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR1</span> <span style='color:red'>|</span> <span
style='color:black'>_S12_SSOE</span><span style='color:red'>;</span><span
style='mso-tab-count:1'>  </span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>//Set SS to SlaveSelectOutput w/ SSOE and MODFEN</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-tab-count:1'>      </span>SPICR2</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR2</span> <span style='color:red'>|</span> <span
style='color:black'>_S12_MODFEN</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>SPICR2</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPICR2</span> <span style='color:red'>&amp;~</span> <span
style='color:black'>_S12_BIDIROE</span><span style='color:red'>;</span> <span
style='mso-tab-count:1'> </span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>//Not Bi-directional output enable = normal</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>lastCmd</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0xAA</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>lastWriteTime</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<b><span style='color:black'>MyTimer_GetTime</span></b><span style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>receivedByte</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0xDE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>blinkState</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>blinkTime</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<b><span style='color:black'>MyTimer_GetTime</span></b><span style='color:red'>()
-</span> <span style='color:#A900A9'>1000</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;Waiting for first active Target</span><span
style='color:#FF00CC'>\r\n</span><span style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span><i><span style='color:#666666'>//LED blinking
begins here until TC sends the first active target (0xCx)</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>while</span></b> <span
style='color:red'>(</span><b><span style='color:black'>firstLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>) !=</span> <span style='color:#A900A9'>0x0C</span><span
style='color:red'>) {</span><span style='mso-spacerun:yes'>  </span><i><span
style='color:#666666'>//Blocking code until receivedByte = 0xCx</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:black'>WriteByte</span></b><span
style='color:red'>(</span><span style='color:black'>lastCmd</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>((</span><b><span style='color:black'>MyTimer_GetTime</span></b><span
style='color:red'>() -</span> <span style='color:black'>blinkTime</span><span
style='color:red'>) &gt;</span> <span style='color:#A900A9'>250</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>      </span>blinkTime</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<b><span style='color:black'>MyTimer_GetTime</span></b><span style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><span style='color:black'>blinkState</span> <span
style='color:red'>==</span> <span style='color:#A900A9'>1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>PTT</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>|=</span>
<span style='color:black'>BIT1HI</span><span style='color:red'>;</span> <span
style='mso-tab-count:3'>             </span><i><span style='color:#666666'>//turn
on red LED</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span style='mso-tab-count:
1'>  </span><span style='mso-spacerun:yes'>  </span>PTT</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>&amp;=</span>
<span style='color:black'>BIT3LO</span><span style='color:red'>;</span> <span
style='mso-tab-count:2'>       </span><span
style='mso-spacerun:yes'>      </span><i><span style='color:#666666'>//turn off
green LED</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span style='mso-tab-count:
1'>  </span><span style='mso-spacerun:yes'>  </span>blinkState</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>else</span></b>
<span style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>PTT</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>|=</span>
<span style='color:black'>BIT3HI</span><span style='color:red'>;</span> <span
style='mso-tab-count:2'>       </span><span
style='mso-spacerun:yes'>     </span><i><span style='color:#666666'>//turn on
green LED</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span style='mso-tab-count:
1'>  </span><span style='mso-spacerun:yes'>  </span>PTT</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>&amp;=</span>
<span style='color:black'>BIT1LO</span><span style='color:red'>;</span> <span
style='mso-tab-count:2'>       </span><span
style='mso-spacerun:yes'>     </span><i><span style='color:#666666'>//turn off
red LED</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span><span style='mso-tab-count:
1'>  </span><span style='mso-spacerun:yes'>  </span>blinkState</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>1</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>ActivatedBeacons</span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>[</span><span
style='font-size:10.0pt;font-family:"Courier New";color:black'>lastActiveBeaconIndex</span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>] =</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <b><span style='color:black'>lastLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>);</span> <i><span style='color:#666666'>//store in array</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>lastActiveBeaconIndex</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>curBeaconIndex</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>isCurBeaconHit</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i><span style='color:#666666'>//printf(&quot;receivedByte
initialization: %x \r\n&quot;, receivedByte);</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Determine the firstLetter of the receivedByte</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>unsigned char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>firstLetter</span></b><span style='color:red'>(</span><span
style='color:blue'>unsigned char</span> <span style='color:black'>inByte</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>return</span></b>
<span style='color:red'>(</span><span style='color:black'>inByte</span><span
style='color:red'>/</span><span style='color:#A900A9'>16</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Determine the lastLetter of the receivedByte</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>unsigned char</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>lastLetter</span></b><span style='color:red'>(</span><span
style='color:blue'>unsigned char</span> <span style='color:black'>inByte</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>return</span></b>
<span style='color:red'>(</span><span style='color:black'>inByte</span><span
style='color:red'>%</span><span style='color:#A900A9'>16</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//myByte is either a 0xAA or 0xEx</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Puts the received byte into receivedByte</span></i><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>void</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>WriteByte</span></b><span style='color:red'>(</span><span
style='color:blue'>unsigned char</span> <span style='color:black'>myByte</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>static char</span> <span
style='color:black'>curWriteGood</span> <span style='color:red'>=</span> <span
style='color:black'>TRUE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>static unsigned char</span>
<span style='color:black'>tempByte</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>static char</span> <span
style='color:black'>timeout</span> <span style='color:red'>=</span> <span
style='color:black'>FALSE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>static char</span> <span
style='color:black'>FBcount</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>static int</span> <span
style='color:black'>i</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>static unsigned int</span>
<span style='color:black'>waitTime</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>11</span><span style='color:red'>;</span> <span
style='mso-tab-count:2'>           </span><i><span style='color:#666666'>//Need
to send a command after &gt;10ms</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>(</span><span style='color:black'>curWriteGood</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>((</span><span style='color:black'>SPISR</span> <span
style='color:red'>&amp;</span> <span style='color:black'>_S12_SPIF</span><span
style='color:red'>) ==</span> <span style='color:black'>_S12_SPIF</span><span
style='color:red'>) {</span><span style='mso-spacerun:yes'>     </span><i><span
style='color:#666666'>//Check read flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>      </span>receivedByte</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPIDR</span><span style='color:red'>;</span> <span
style='mso-tab-count:4'>                    </span><i><span style='color:#666666'>//Read
good</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><span style='color:black'>receivedByte</span> <span
style='color:red'>==</span> <span style='color:#A900A9'>0xFB</span><span
style='color:red'>)</span> <span style='color:black'>FBcount</span><span
style='color:red'>++;</span><span style='mso-tab-count:1'>      </span><i><span
style='color:#666666'>//&quot;Busy&quot; count, used for debugging timeouts
from radio overload</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>else</span></b>
<span style='color:black'>FBcount</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><span style='color:black'>FBcount</span> <span
style='color:red'>&gt;</span> <span style='color:#A900A9'>10</span><span
style='color:red'>)</span> <b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;FB timeout %d</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;,</span> <span style='color:black'>FBcount</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><i><span style='color:#666666'>//printf(&quot;Received
Byte: %x\r\n&quot;, receivedByte);</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>((</span><b><span style='color:black'>MyTimer_GetTime</span></b><span
style='color:red'>() -</span> <span style='color:black'>lastWriteTime</span><span
style='color:red'>) &gt;</span> <span style='color:black'>waitTime</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>((</span><span style='color:black'>SPISR</span> <span
style='color:red'>&amp;</span> <span style='color:black'>_S12_SPTEF</span><span
style='color:red'>) ==</span> <span style='color:black'>_S12_SPTEF</span><span
style='color:red'>) {</span><span style='mso-spacerun:yes'>             </span><i><span
style='color:#666666'>//Check write flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>lastWriteTime</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<b><span style='color:black'>MyTimer_GetTime</span></b><span style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>SPIDR</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>myByte</span><span style='color:red'>;</span> <span
style='mso-tab-count:6'>                                    </span><i><span
style='color:#666666'>//Write out good byte to SPI lines</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><i><span style='color:#666666'>//printf(&quot;Sent
Byte: %x\r\n&quot;, myByte);</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>curWriteGood</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>else</span></b> <span
style='color:red'>{</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>((</span><span style='color:black'>SPISR</span> <span
style='color:red'>&amp;</span> <span style='color:black'>_S12_SPIF</span><span
style='color:red'>) ==</span> <span style='color:black'>_S12_SPIF</span><span
style='color:red'>) {</span> <span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>            </span><i><span style='color:#666666'>//Check
read flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>      </span>tempByte</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPIDR</span><span style='color:red'>;</span> <span
style='mso-tab-count:4'>                        </span><span style='mso-tab-count:
2'>            </span><i><span style='color:#666666'>//Read bad</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>((</span><b><span style='color:black'>MyTimer_GetTime</span></b><span
style='color:red'>() -</span> <span style='color:black'>lastWriteTime</span><span
style='color:red'>) &gt;</span> <span style='color:black'>waitTime</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>((</span><span style='color:black'>SPISR</span> <span
style='color:red'>&amp;</span> <span style='color:black'>_S12_SPTEF</span><span
style='color:red'>) ==</span> <span style='color:black'>_S12_SPTEF</span><span
style='color:red'>) {</span><span style='mso-spacerun:yes'>             </span><i><span
style='color:#666666'>//Check write flag</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>lastWriteTime</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<b><span style='color:black'>MyTimer_GetTime</span></b><span style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>SPIDR</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0x00</span><span style='color:red'>;</span> <span
style='mso-tab-count:7'>                                      </span><i><span
style='color:#666666'>//Write out bad byte to SPI lines</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>        </span>curWriteGood</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TRUE</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Returns SPI_READY, SPI_TARGET_STATUS_READY, SPI_GAME_OVER,
SPI_DELAY, or SPI_ERROR</span></i><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'>SPI_Status_t</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>SPI_getStatus</span></b><span style='color:red'>(</span><span
style='color:blue'>void</span><span style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>switch</span></b>
<span style='color:red'>(</span><span style='color:black'>state</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_GAME_OVER</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>return</span></b>
<span style='color:black'>state</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_ERROR</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>return</span></b>
<span style='color:black'>state</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_DELAY</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>      </span>lastCmd</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0xAA</span><span style='color:red'>;</span><span
style='mso-spacerun:yes'>     </span><span style='mso-tab-count:1'>    </span><i><span
style='color:#666666'>//Send AA into WriteByte until response is not OxDE</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_READY</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:black'>WriteByte</span></b><span
style='color:red'>(</span><span style='color:black'>lastCmd</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><span style='color:black'>receivedByte</span> <span
style='color:red'>==</span> <span style='color:#A900A9'>0xFB</span><span
style='color:red'>)</span> <b><span style='color:blue'>return</span></b> <span
style='color:black'>state</span><span style='color:red'>;</span> <span
style='mso-tab-count:1'>  </span><span style='mso-spacerun:yes'>       </span><i><span
style='color:#666666'>//Do nothing</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>else</span></b>
<span style='color:red'>{</span> <span style='mso-tab-count:4'>                       </span><span
style='mso-spacerun:yes'>                  </span><i><span style='color:#666666'>//Process
response</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>switch</span></b><span
style='color:red'>(</span><b><span style='color:black'>firstLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>)) {</span><span style='mso-tab-count:2'>           </span><i><span
style='color:#666666'>//Get the firstLetter of the receivedByte</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>case</span></b>
<span style='color:#A900A9'>0x0C</span><span style='color:red'>:</span> <span
style='mso-tab-count:2'>         </span><span
style='mso-spacerun:yes'>                        </span><i><span
style='color:#666666'>//if C, Active beacon</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><b><span style='color:black'>lastLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>) !=</span> <span style='color:black'>ActivatedBeacons</span><span
style='color:red'>[</span><span style='color:black'>lastActiveBeaconIndex</span><span
style='color:red'>]) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>             
</span>lastActiveBeaconIndex</span><span style='font-size:10.0pt;font-family:
"Courier New";color:red'>++;<span style='mso-tab-count:3'>                </span></span><i><span
style='font-size:10.0pt;font-family:"Courier New";color:#666666'>//got a new
target assignment</span></i><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>             
</span>ActivatedBeacons</span><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>[</span><span style='font-size:10.0pt;font-family:"Courier New";
color:black'>lastActiveBeaconIndex</span><span style='font-size:10.0pt;
font-family:"Courier New";color:red'>] =</span><span style='font-size:10.0pt;
font-family:"Courier New"'> <b><span style='color:black'>lastLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>            </span>state</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPI_READY</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>case</span></b>
<span style='color:#A900A9'>0x0D</span><span style='color:red'>:</span> <i><span
style='color:#666666'>//Special command</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><b><span style='color:black'>lastLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>) ==</span> <span style='color:#A900A9'>0x0E</span><span
style='color:red'>)</span> <span style='color:black'>state</span> <span
style='color:red'>=</span> <span style='color:black'>SPI_DELAY</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>else</span></b>
<span style='color:black'>state</span> <span style='color:red'>=</span> <span
style='color:black'>SPI_GAME_OVER</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>case</span></b>
<span style='color:#A900A9'>0x05</span><span style='color:red'>:</span><span
style='mso-tab-count:1'>    </span><i><span style='color:#666666'>//Current
beacon is active but not lit. Do the same thing as for case 0x06</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>case</span></b>
<span style='color:#A900A9'>0x06</span><span style='color:red'>:</span><span
style='mso-tab-count:1'>    </span><i><span style='color:#666666'>//Current
beacon is active and lit</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><b><span style='color:black'>lastLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>) ==</span> <span style='color:black'>ActivatedBeacons</span><span
style='color:red'>[</span><span style='color:black'>curBeaconIndex</span><span
style='color:red'>]) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>              </span>isCurBeaconHit</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>FALSE</span><span style='color:red'>;</span><span
style='mso-tab-count:2'>           </span><i><span style='color:#666666'>//set isCurBeacon
to show it is not hit</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>             
</span>requestedTargetStatus</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:red'>=</span> <span style='color:black'>FALSE</span><span
style='color:red'>;</span><span style='mso-tab-count:1'>    </span><i><span
style='color:#666666'>//Only requestTargetStatus (call 0xEx) after beacon is
hit (called in <st1:place w:st="on">Main</st1:place>)</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>             
</span>unreadTargetStatus</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:red'>=</span> <span style='color:black'>TRUE</span><span
style='color:red'>;</span><span style='mso-tab-count:2'>        </span><i><span
style='color:#666666'>//TargetStatus has not been read</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>case</span></b>
<span style='color:#A900A9'>0x07</span><span style='color:red'>:</span> <i><span
style='color:#666666'>//Current beacon has been hit but not lit</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>case</span></b>
<span style='color:#A900A9'>0x08</span><span style='color:red'>:</span> <i><span
style='color:#666666'>//Current beacon has been hit and lit</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><b><span style='color:black'>lastLetter</span></b><span
style='color:red'>(</span><span style='color:black'>receivedByte</span><span
style='color:red'>) ==</span> <span style='color:black'>ActivatedBeacons</span><span
style='color:red'>[</span><span style='color:black'>curBeaconIndex</span><span
style='color:red'>]) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>             
</span>requestedTargetStatus</span><span style='font-size:10.0pt;font-family:
"Courier New"'> <span style='color:red'>=</span> <span style='color:black'>FALSE</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>             
</span>unreadTargetStatus</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<span style='color:red'>=</span> <span style='color:black'>TRUE</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>              </span>isCurBeaconHit</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>TRUE</span><span style='color:red'>;</span><span
style='mso-tab-count:3'>                  </span><i><span style='color:#666666'>//set
TRUE to show it has been hit</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>              </span>curBeaconIndex</span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>++;</span><span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
4'>                       </span><i><span style='color:#666666'>//get the index
for next activatedBeacon</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>            </span>state</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPI_READY</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>case</span></b>
<span style='color:#A900A9'>0x0F</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>            </span>state</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPI_ERROR</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><span style='color:black'>requestedTargetStatus</span><span
style='color:red'>) {</span><span style='mso-tab-count:3'>                  </span><span
style='mso-spacerun:yes'>           </span><i><span style='color:#666666'>//if
TRUE (set in <st1:place w:st="on">Main</st1:place> after hitting the beacon)</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><span style='color:black'>ActivatedBeacons</span><span
style='color:red'>[</span><span style='color:black'>curBeaconIndex</span><span
style='color:red'>] != -</span><span style='color:#A900A9'>1</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>            </span>lastCmd</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:#A900A9'>0xE0</span> <span style='color:red'>+</span> <span
style='color:black'>ActivatedBeacons</span><span style='color:red'>[</span><span
style='color:black'>curBeaconIndex</span><span style='color:red'>];</span><span
style='mso-spacerun:yes'>   </span><i><span style='color:#666666'>//Send 0xEx
to TC</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>else</span></b>
<span style='color:black'>lastCmd</span> <span style='color:red'>=</span> <span
style='color:#A900A9'>0xAA</span><span style='color:red'>;</span><span
style='mso-tab-count:5'>                          </span><span
style='mso-spacerun:yes'>           </span><i><span style='color:#666666'>//otherwise,
always write 0xAA to TC</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>if</span></b>
<span style='color:red'>(</span><span style='color:black'>state</span> <span
style='color:red'>==</span> <span style='color:black'>SPI_READY</span> <span
style='color:red'>&amp;&amp;</span> <span style='color:black'>unreadTargetStatus</span><span
style='color:red'>)</span> <b><span style='color:blue'>return</span></b> <span
style='color:black'>SPI_TARGET_STATUS_READY</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>else return</span></b>
<span style='color:black'>state</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><i><span style='font-size:10.0pt;font-family:"Courier New";
color:#666666'>//Test Harness</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#ifdef TEST</span><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:blue'>void</span><span style='font-size:10.0pt;font-family:"Courier New"'>
<b><span style='color:black'>main</span></b><span style='color:red'>(</span><span
style='color:blue'>void</span><span style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>char</span> <span
style='color:black'>ch</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='color:blue'>int</span> <span
style='color:black'>a</span><span style='color:red'>=</span><span
style='color:#A900A9'>0</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>SPI_Status_t status</span><span
style='font-size:10.0pt;font-family:"Courier New";color:red'>,</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:black'>lastStatus</span><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:black'>SPI_Init</span></b><span
style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:black'>MyTimer_Init</span></b><span
style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;Test started</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>  </span>lastStatus</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>SPI_ERROR</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>   </span><b><span style='color:blue'>while</span></b>
<span style='color:red'>(</span><span style='color:#A900A9'>1</span><span
style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>    </span>status</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<b><span style='color:black'>SPI_getStatus</span></b><span style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>if</span></b> <span
style='color:red'>(</span><span style='color:black'>status</span> <span
style='color:red'>!=</span> <span style='color:black'>lastStatus</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>      </span>lastStatus</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>=</span>
<span style='color:black'>status</span><span style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>switch</span></b><span
style='color:red'>(</span><span style='color:black'>status</span><span
style='color:red'>){</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_GAME_OVER</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;GAME_OVER</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_ERROR</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;ERROR</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;lastCmd=</span> <span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;,</span> <span style='color:black'>lastCmd</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_DELAY</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;DELAY</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_READY</span><span style='color:red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:black'>SPI_TARGET_STATUS_READY</span><span style='color:
red'>:</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;Target Status is Ready!</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>if</span></b><span
style='color:red'>(</span><b><span style='color:black'>kbhit</span></b><span
style='color:red'>()){</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;Enter Command: &quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:black'><span style='mso-spacerun:yes'>      </span>ch</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:red'>= (</span><span
style='color:blue'>char</span><span style='color:red'>)</span> <b><span
style='color:black'>getchar</span></b><span style='color:red'>();</span> <i><span
style='color:#666666'>//pauses execution, waiting for input</span></i><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><b><span style='color:blue'>switch</span></b>
<span style='color:red'>(</span><span style='color:black'>ch</span><span
style='color:red'>) {</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:red'>'a':</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;Requested current target: &quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;%d</span> <span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;,</span> <b><span style='color:black'>SPI_getCurTarget</span></b><span
style='color:red'>());</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:red'>'h':</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;Is Current Target Hit? &quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;%d</span> <span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;,</span> <b><span style='color:black'>SPI_isCurTargetHit</span></b><span
style='color:red'>());</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:red'>'p':</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:2'>          </span><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>for</span></b><span
style='color:red'>(</span><span style='color:black'>a</span><span
style='color:red'>=</span><span style='color:#A900A9'>0</span><span
style='color:red'>;</span> <span style='color:black'>a</span><span
style='color:red'>&lt;</span><span style='color:#A900A9'>15</span><span
style='color:red'>;</span> <span style='color:black'>a</span><span
style='color:red'>++){</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:2'>          </span><span
style='mso-spacerun:yes'>      </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;%d &quot;,</span> <span style='color:black'>ActivatedBeacons</span><span
style='color:red'>[</span><span style='color:black'>a</span><span
style='color:red'>]);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:2'>          </span><span
style='mso-spacerun:yes'>    </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:red'>'t':</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;Requested Current Target Status . . . .</span><span
style='color:#FF00CC'>\r\n</span><span style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>SPI_requestTargetStatus</span></b><span
style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:2'>          </span><span
style='mso-spacerun:yes'>  </span><b><span style='color:blue'>case</span></b> <span
style='color:red'>'r':</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;ReceivedByte= &quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;%x</span> <span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;,</span> <span style='color:black'>receivedByte</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:red'>'s':</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;SentByte= &quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;%x</span> <span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;,</span> <span style='color:black'>lastCmd</span><span
style='color:red'>);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><b><span style='color:blue'>case</span></b>
<span style='color:red'>'z':</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>printf</span></b><span
style='color:red'>(&quot;skipping cur target</span><span style='color:#FF00CC'>\r\n</span><span
style='color:red'>&quot;);</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:black'>SPI_skipCurTarget</span></b><span
style='color:red'>();</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span><b><span style='color:blue'>break</span></b><span
style='color:red'>;</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>   </span><span style='color:red'>}</span><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:red'>}</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-pagination:none;background:white;mso-layout-grid-align:
none;text-autospace:none'><span style='font-size:10.0pt;font-family:"Courier New";
color:#00B800'>#endif</span><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

</div>

</body>

</html>
